var MarkdownDeepEditor=new function(){function u(n,t){return n.substr(0,t.length)==t}function ht(n,t){return n.substr(-t.length)==t}function i(n){return n==" "||n=="\t"||n=="\r"||n=="\n"}function r(n){return n=="\r"||n=="\n"}function f(n){for(var t=0,r=n.length;t<r&&i(n.charAt(t));)t++;while(r-1>t&&i(n.charAt(r-1)))r--;return n.substr(t,r-t)}function e(n,t,i){n.addEventListener?n.addEventListener(t,i,!1):n.attachEvent&&n.attachEvent("on"+t,i)}function w(n){return n.preventDefault&&n.preventDefault(),n.cancelBubble!==undefined&&(n.cancelBubble=!0,n.keyCode=0,n.returnValue=!1),!1}function o(){}function b(n,t,i,r){return n<t?n:n<t+i?t:n+r-i}function a(n,t){n.setSelectionRange||(s=!0);this.m_lastContent=null;this.m_undoStack=[];this.m_undoPos=0;this.m_undoMode=l;this.Markdown=new MarkdownDeep.Markdown;this.Markdown.SafeMode=!1;this.Markdown.ExtraMode=!0;this.Markdown.NewWindowForLocalLinks=!0;this.Markdown.NewWindowForExternalLinks=!0;this.m_textarea=n;this.m_divHtml=t;var i=this;e(n,"keyup",function(){i.onMarkdownChanged()});e(n,"keydown",function(n){return i.onKeyDown(n)});e(n,"paste",function(){i.onMarkdownChanged()});e(n,"input",function(){i.onMarkdownChanged()});e(n,"mousedown",function(){i.SetUndoMode(l)});this.onMarkdownChanged()}var s=!1,k=9,v=13,d=33,g=34,nt=36,tt=35,it=37,rt=39,ut=38,ft=40,et=8,ot=46,h=0,c=1,y=2,l=3,st=4,p={Z:"undo",Y:"redo",B:"bold",I:"italic",H:"heading",K:"code",U:"ullist",O:"ollist",Q:"indent",E:"outdent",L:"link",G:"img",R:"hr","0":"h0","1":"h1","2":"h2","3":"h3","4":"h4","5":"h5","6":"h6"},n,t;n=o.prototype;n.InitFromTextArea=function(n){var t,i,r;this.m_textarea=n;s?(t=document.selection.createRange(),i=t.duplicate(),i.moveToElementText(n),r=-i.moveStart("character",-1e7),this.m_selectionStart=-t.moveStart("character",-1e7)-r,this.m_selectionEnd=-t.moveEnd("character",-1e7)-r,this.m_text=n.value.replace(/\r\n/gm,"\n")):(this.m_selectionStart=n.selectionStart,this.m_selectionEnd=n.selectionEnd,this.m_text=n.value)};n.Duplicate=function(){var n=new o;return n.m_textarea=this.m_textarea,n.m_selectionEnd=this.m_selectionEnd,n.m_selectionStart=this.m_selectionStart,n.m_text=this.m_text,n};n.Apply=function(){var n,t;s?(this.m_textarea.value=this.m_text,this.m_textarea.focus(),n=this.m_textarea.createTextRange(),n.collapse(!0),n.moveEnd("character",this.m_selectionEnd),n.moveStart("character",this.m_selectionStart),n.select()):(t=this.m_textarea.scrollTop,this.m_textarea.value=this.m_text,this.m_textarea.focus(),this.m_textarea.setSelectionRange(this.m_selectionStart,this.m_selectionEnd),this.m_textarea.scrollTop=t)};n.ReplaceSelection=function(n){this.m_text=this.m_text.substr(0,this.m_selectionStart)+n+this.m_text.substr(this.m_selectionEnd);this.m_selectionEnd=this.m_selectionStart+n.length};n.ReplaceAt=function(n,t,i){this.m_text=this.m_text.substr(0,n)+i+this.m_text.substr(n+t);this.m_selectionStart=b(this.m_selectionStart,n,t,i.length);this.m_selectionEnd=b(this.m_selectionEnd,n,t,i.length)};n.getSelectedText=function(){return this.m_text.substr(this.m_selectionStart,this.m_selectionEnd-this.m_selectionStart)};n.InflateSelection=function(n,t){this.m_selectionEnd+=t;this.m_selectionStart-=n};n.PreceededBy=function(n){return this.m_selectionStart>=n.length&&this.m_text.substr(this.m_selectionStart-n.length,n.length)==n};n.FollowedBy=function(n){return this.m_text.substr(this.m_selectionEnd,n.length)==n};n.TrimSelection=function(){while(i(this.m_text.charAt(this.m_selectionStart)))this.m_selectionStart++;while(this.m_selectionEnd>this.m_selectionStart&&i(this.m_text.charAt(this.m_selectionEnd-1)))this.m_selectionEnd--};n.IsStartOfLine=function(n){return n==0||r(this.m_text.charAt(n-1))};n.FindStartOfLine=function(n){while(n>0&&!r(this.m_text.charAt(n-1)))n--;return n};n.FindEndOfLine=function(n){while(n<this.m_text.length&&!r(this.m_text.charAt(n)))n++;return n};n.FindNextLine=function(n){return this.SkipEol(this.FindEndOfLine(n))};n.SkipWhiteSpace=function(n){while(n<this.m_text.length&&i(this.m_text.charAt(n)))n++;return n};n.SkipEol=function(n){return this.m_text.substr(n,2)=="\r\n"?n+2:r(this.m_text.charAt(n))?n+1:n};n.SkipPreceedingEol=function(n){return n>2&&this.m_text.substr(n-2,2)=="\r\n"?n-2:n>1&&r(this.m_text.charAt(n-1))?n-1:n};n.SelectWholeLines=function(){this.m_selectionStart=this.FindStartOfLine(this.m_selectionStart);this.IsStartOfLine(this.m_selectionEnd)||(this.m_selectionEnd=this.SkipEol(this.FindEndOfLine(this.m_selectionEnd)))};n.SkipPreceedingWhiteSpace=function(n){while(n>0&&i(this.m_text.charAt(n-1)))n--;return n};n.SkipFollowingWhiteSpace=function(n){while(i(this.m_text.charAt(n)))n++;return n};n.SelectSurroundingWhiteSpace=function(){this.m_selectionStart=this.SkipPreceedingWhiteSpace(this.m_selectionStart);this.m_selectionEnd=this.SkipFollowingWhiteSpace(this.m_selectionEnd)};n.CheckSimpleSelection=function(){var n=this.getSelectedText(),t=n.match(/\n[ \t\r]*\n/);return t?(alert("Please make a selection that doesn't include a paragraph break"),!1):!0};n.IsBlankLine=function(n){for(var u,f=this.m_text.length,t=n;t<f;t++){if(u=this.m_text[t],r(u))return!0;if(!i(this.m_text.charAt(t)))return!1}return!0};n.FindStartOfParagraph=function(n){var i=n,t;if(n=this.FindStartOfLine(n),this.IsBlankLine(n))return n;while(n>0){if(t=this.FindStartOfLine(this.SkipPreceedingEol(n)),t==0)break;if(this.IsBlankLine(t))break;n=t}if(this.DetectListType(n).m_prefixLen!=0)for(n=this.FindStartOfLine(i);n>0;){if(this.DetectListType(n).m_prefixLen!=0)return n;n=this.FindStartOfLine(this.SkipPreceedingEol(n))}return n};n.FindEndOfParagraph=function(n){while(n<this.m_text.length){if(this.IsBlankLine(n))break;n=this.FindNextLine(n)}return n};n.SelectParagraph=function(){this.m_selectionStart=this.FindStartOfParagraph(this.m_selectionStart);this.m_selectionEnd=this.FindEndOfParagraph(this.m_selectionStart)};n.DetectListType=function(n){var i=this.m_text.substr(n,10),t=i.match(/^\s{0,3}(\*|\d+\.)(?:\ |\t)*/);return t?t[1]=="*"?{m_listType:"*",m_prefixLen:t[0].length}:{m_listType:"1",m_prefixLen:t[0].length}:{m_listType:"",m_prefixLen:0}};n=a.prototype;t=a.prototype;n.onKeyDown=function(n){var t=null,i;if(n.ctrlKey||n.metaKey){if(i=String.fromCharCode(n.charCode||n.keyCode),!this.disableShortCutKeys&&p[i]!=undefined)return this.InvokeCommand(p[i]),w(n);switch(i){case"V":t=c;break;case"X":t=y}}else switch(n.keyCode){case k:if(this.disableTabHandling)t=c;else return this.InvokeCommand(n.shiftKey?"untab":"tab"),w(n);break;case it:case rt:case ut:case ft:case nt:case tt:case d:case g:t=l;break;case et:case ot:t=y;break;case v:t=st;break;default:t=c}t!=null&&this.SetUndoMode(t);this.disableAutoIndent||n.keyCode==v&&(!s||n.ctrlKey)&&this.IndentNewLine()};n.SetUndoMode=function(n){this.m_undoMode!=n&&(this.m_undoMode=n,this.CaptureUndoState())};n.CaptureUndoState=function(){var n=new o;n.InitFromTextArea(this.m_textarea);this.m_undoStack.splice(this.m_undoPos,this.m_undoStack.length-this.m_undoPos,n);this.m_undoPos=this.m_undoStack.length};n.onMarkdownChanged=function(){var n=this.m_textarea.value,t;if(n!==this.m_lastContent||this.m_lastContent===null){if(this.onPreTransform)this.onPreTransform(this,n);if(t=this.Markdown.Transform(n),this.onPostTransform)this.onPostTransform(this,t);if(this.m_divHtml&&(this.m_divHtml.innerHTML=t),this.onPostUpdateDom)this.onPostUpdateDom(this);this.m_lastContent=n}};t.onOptionsChanged=function(){this.m_lastContent=null;this.onMarkdownChanged()};t.cmd_undo=function(){this.m_undoPos>0&&(this.m_undoPos==this.m_undoStack.length&&(this.CaptureUndoState(),this.m_undoPos--),this.m_undoPos--,this.m_undoStack[this.m_undoPos].Apply(),this.m_undoMode=h,this.onMarkdownChanged())};t.cmd_redo=function(){this.m_undoPos+1<this.m_undoStack.length&&(this.m_undoPos++,this.m_undoStack[this.m_undoPos].Apply(),this.m_undoMode=h,this.onMarkdownChanged(),this.m_undoPos==this.m_undoStack.length-1&&this.m_undoStack.pop())};n.setHeadingLevel=function(n,t){var i,u,r,e,o,s,h;if(n.SelectParagraph(),n.SelectSurroundingWhiteSpace(),i=n.getSelectedText(),i=f(i),u=0,r=i.match(/^(\#+)(.*?)(\#+)?$/),r?(i=f(r[2]),u=r[1].length):(r=i.match(/^(.*?)(?:\r\n|\n|\r)\s*(\-*|\=*)$/),r?(i=f(r[1]),u=r[2].charAt(0)=="="?1:0):(i=i.replace(/(\r\n|\n|\r)/gm,""),u=0)),t==-1&&(t=(u+1)%4),e=0,o=0,t==0){if(i=="Heading")return n.ReplaceSelection(""),!0;o=i.length;e=0}else{for(i==""&&(i="Heading"),e=t+1,o=i.length,s="",h=0;h<t;h++)s+="#";i=s+" "+i+" "+s}return i+="\n\n",n.m_selectionStart!=0&&(i="\n\n"+i,e+=2),n.ReplaceSelection(i),n.m_selectionStart+=e,n.m_selectionEnd=n.m_selectionStart+o,!0};t.cmd_heading=function(n){return this.setHeadingLevel(n,-1)};t.cmd_h0=function(n){return this.setHeadingLevel(n,0)};t.cmd_h1=function(n){return this.setHeadingLevel(n,1)};t.cmd_h2=function(n){return this.setHeadingLevel(n,2)};t.cmd_h3=function(n){return this.setHeadingLevel(n,3)};t.cmd_h4=function(n){return this.setHeadingLevel(n,4)};t.cmd_h5=function(n){return this.setHeadingLevel(n,5)};t.cmd_h6=function(n){return this.setHeadingLevel(n,6)};n.IndentCodeBlock=function(n,t){var r,o,e,h,i,s;for(n.SelectWholeLines(),r=n.getSelectedText().split("\n"),i=0;i<r.length;i++)if(r[i].charAt(0)=="\t"){for(o="",e=0;r[i].charAt(e)=="\t";)o+="    ",e++;h=o+r[i].substr(e);r.splice(i,1,h)}if(t===null){for(i=0;i<r.length;i++)if(f(r[i])!=""){if(r[i].charAt(0)=="\t"){for(o="",e=0;r[i].charAt(e)=="\t";)o+="    ",e++;h=o+r[i].substr(i);r.splice(i,1,h)}if(!u(r[i],"    "))break}t=i!=r.length}for(i=0;i<r.length;i++)f(r[i])!=""&&(s=r[i],t?s="    "+r[i]:u(r[i],"\t")?s=r[i].substr(1):u(r[i],"    ")&&(s=r[i].substr(4)),r.splice(i,1,s));n.ReplaceSelection(r.join("\n"))};t.cmd_code=function(n){if(n.m_selectionStart==n.m_selectionEnd){var t=n.FindStartOfLine(n.m_selectionStart);if(n.IsBlankLine(t))return n.SelectSurroundingWhiteSpace(),n.ReplaceSelection("\n\n    Code\n\n"),n.m_selectionStart+=6,n.m_selectionEnd=n.m_selectionStart+4,!0}return n.getSelectedText().indexOf("\n")<0?(n.TrimSelection(),n.PreceededBy("`")&&n.m_selectionStart--,n.FollowedBy("`")&&n.m_selectionEnd++,this.bold_or_italic(n,"`")):(this.IndentCodeBlock(n,null),!0)};t.cmd_tab=function(n){var i,t,r;if(n.getSelectedText().indexOf("\n")>0)this.IndentCodeBlock(n,!0);else{for(i=n.FindStartOfLine(n.m_selectionStart),t=i;t<n.m_selectionStart;t++)if(n.m_text.charAt(t)!=" ")break;t==n.m_selectionStart?(r=4-(t-i)%4,n.ReplaceSelection("    ".substr(0,r))):n.ReplaceSelection("\t");n.m_selectionStart=n.m_selectionEnd}return!0};t.cmd_untab=function(n){return n.getSelectedText().indexOf("\n")>0?(this.IndentCodeBlock(n,!1),!0):!1};n.bold_or_italic=function(n,t){var f=n.m_text,r=t.length,i=n.getSelectedText();return u(i,t)&&ht(i,t)?n.ReplaceSelection(i.substr(r,i.length-r*2)):(n.TrimSelection(),i=n.getSelectedText(),i=i?i.replace(/(\r\n|\n|\r)/gm,""):"text",n.ReplaceSelection(t+i+t),n.InflateSelection(-r,-r)),!0};t.cmd_bold=function(n){return n.CheckSimpleSelection()?(n.TrimSelection(),n.PreceededBy("**")&&(n.m_selectionStart-=2),n.FollowedBy("**")&&(n.m_selectionEnd+=2),this.bold_or_italic(n,"**")):!1};t.cmd_italic=function(n){return n.CheckSimpleSelection()?(n.TrimSelection(),(n.PreceededBy("*")&&!n.PreceededBy("**")||n.PreceededBy("***"))&&(n.m_selectionStart-=1),(n.FollowedBy("*")&&!n.PreceededBy("**")||n.FollowedBy("***"))&&(n.m_selectionEnd+=1),this.bold_or_italic(n,"*")):!1};n.indent_or_outdent=function(n,t){var i,r,f;if(!1&&n.m_selectionStart==n.m_selectionEnd)return n.SelectSurroundingWhiteSpace(),n.ReplaceSelection("\n\n> Quote\n\n"),n.m_selectionStart+=4,n.m_selectionEnd=n.m_selectionStart+5,!0;for(n.SelectWholeLines(),i=n.getSelectedText().split("\n"),r=0;r<i.length-1;r++)f=i[r],t?u(i[r],"> ")&&(f=i[r].substr(2)):f="> "+i[r],i.splice(r,1,f);return n.ReplaceSelection(i.join("\n")),!0};t.cmd_indent=function(n){return this.indent_or_outdent(n,!1)};t.cmd_outdent=function(n){return this.indent_or_outdent(n,!0)};n.handle_list=function(n,t){var f=[],c,r,s,u,o,i,e,l,h;if(n.getSelectedText().indexOf("\n")>0)for(n.SelectWholeLines(),r=n.m_selectionStart,f.push(r);;){if(r=n.FindNextLine(r),r>=n.m_selectionEnd)break;f.push(r)}else f.push(n.FindStartOfLine(n.m_selectionStart));for(c=t=="*"?"* ":"1. ",i=0;i<f.length;i++)if(e=n.DetectListType(f[i]),e.m_listType==t){c="";break}for(i=f.length-1;i>=0;i--)r=f[i],e=n.DetectListType(r),n.ReplaceAt(r,e.m_prefixLen,c);for(s=new MarkdownDeep.Markdown,s.ExtraMode=!0,u=s.GetListItems(n.m_text,n.m_selectionStart);u!=null;){for(o=0,i=0;i<u.length-1;i++){if(e=n.DetectListType(u[i]+o),e.m_listType!="1")break;l=(i+1).toString()+". ";n.ReplaceAt(u[i]+o,e.m_prefixLen,l);o+=l.length-e.m_prefixLen}h=s.GetListItems(n.m_text,u[u.length-1]+o);u=h!=null&&h[0]!=u[0]?h:null}return f.length>1&&n.SelectWholeLines(),!0};t.cmd_ullist=function(n){return this.handle_list(n,"*")};t.cmd_ollist=function(n){return this.handle_list(n,"1")};t.cmd_link=function(n){var i,t,r;return(n.TrimSelection(),!n.CheckSimpleSelection())?!1:(i=prompt("Enter the target URL:"),i===null)?!1:(t=n.getSelectedText(),t.length==0&&(t="link text"),r="["+t+"]("+i+")",n.ReplaceSelection(r),n.m_selectionStart++,n.m_selectionEnd=n.m_selectionStart+t.length,!0)};t.cmd_img=function(n){var i,t,r;return(n.TrimSelection(),!n.CheckSimpleSelection())?!1:(i=prompt("Enter the image URL"),i===null)?!1:(t=n.getSelectedText(),t.length==0&&(t="Image Text"),r="!["+t+"]("+i+")",n.ReplaceSelection(r),n.m_selectionStart+=2,n.m_selectionEnd=n.m_selectionStart+t.length,!0)};t.cmd_hr=function(n){return n.SelectSurroundingWhiteSpace(),n.m_selectionStart==0?n.ReplaceSelection("----------\n\n"):n.ReplaceSelection("\n\n----------\n\n"),n.m_selectionStart=n.m_selectionEnd,!0};t.IndentNewLine=function(){var t=this,n,i=function(){var i,r,u,f;for(window.clearInterval(n),i=new o,i.InitFromTextArea(t.m_textarea),r=i.FindStartOfLine(i.SkipPreceedingEol(i.m_selectionStart)),u=r;;){if(f=i.m_text.charAt(u),f!=" "&&f!="\t")break;u++}u>r&&(i.ReplaceSelection(i.m_text.substr(r,u-r)),i.m_selectionStart=i.m_selectionEnd);i.Apply()};return n=window.setInterval(i,1),!1};t.cmd_indented_newline=function(n){var t,i,r;for(n.ReplaceSelection("\n"),n.m_selectionStart=n.m_selectionEnd,t=n.FindStartOfLine(n.SkipPreceedingEol(n.m_selectionStart)),i=t;;){if(r=n.m_text.charAt(i),r!=" "&&r!="\t")break;i++}return i>t&&(n.ReplaceSelection(n.m_text.substr(t,i-t)),n.m_selectionStart=n.m_selectionEnd),!0};t.InvokeCommand=function(n){var t,i;if(n=="undo"||n=="redo"){this["cmd_"+n]();this.m_textarea.focus();return}return t=new o,t.InitFromTextArea(this.m_textarea),i=t.Duplicate(),this["cmd_"+n](t)?(this.m_undoMode=h,this.m_undoStack.splice(this.m_undoPos,this.m_undoStack.length-this.m_undoPos,i),this.m_undoPos++,t.Apply(),this.onMarkdownChanged(),!0):(this.m_textarea.focus(),!1)};delete n;delete t;this.Editor=a};
/*
//# sourceMappingURL=MarkdownDeepEditor.min.js.map
*/