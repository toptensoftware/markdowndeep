var MarkdownDeep=new function(){function ut(n,t){if(n.indexOf!==undefined)return n.indexOf(t);for(var i=0;i<n.length;i++)if(n[i]===t)return i;return-1}function a(){this.m_SpanFormatter=new fi(this);this.m_SpareBlocks=[];this.m_StringBuilder=new v;this.m_StringBuilderFinal=new v}function uu(n,t,i,r){return n.slice(0,t).concat(r).concat(n.slice(t+i))}function wt(n){return n>="0"&&n<="9"}function fu(n){return n>="0"&&n<="9"||n>="a"&&n<="f"||n>="A"&&n<="F"}function nr(n){return n>="a"&&n<="z"||n>="A"&&n<="Z"}function d(n){return n>="a"&&n<="z"||n>="A"&&n<="Z"||n>="0"&&n<="9"}function f(n){return n==" "||n=="\t"||n=="\r"||n=="\n"}function ft(n){return n==" "||n=="\t"}function bt(n){return n=="\r"||n=="\n"}function kt(n){return n=="*"||n=="_"}function dt(n,t){switch(n){case"\\":case"`":case"*":case"_":case"{":case"}":case"[":case"]":case"(":case")":case">":case"#":case"+":case"-":case".":case"!":return!0;case":":case"|":case"=":case"<":return t}return!1}function gt(n,t){var r,i;if(n.charAt(t)!="&")return-1;if(r=t,t++,n.charAt(t)=="#"?(t++,n.charAt(t)=="x"||n.charAt(t)=="X"?(t++,i=fu):i=wt):i=d,i(n.charAt(t))){for(t++;i(n.charAt(t));)t++;if(n.charAt(t)==";")return t++,t}return t=r,-1}function it(n,t){var i=n.indexOf("\\"),u,r;if(i<0)return n;for(u=new v,r=0;i>=0;)dt(n.charAt(i+1),t)&&(i>r&&u.Append(n.substr(r,i-r)),r=i+1),i=n.indexOf("\\",i+1);return r<n.length&&u.Append(n.substr(r,n.length-r)),u.ToString()}function p(n){for(var t=0,i=n.length;t<i&&f(n.charAt(t));)t++;while(i-1>t&&f(n.charAt(i-1)))i--;return n.substr(t,i-t)}function eu(n){var t=n.indexOf("@"),i;return t<0?!1:(i=n.lastIndexOf("."),i<t)?!1:!0}function ou(n){return(n=n.toLowerCase(),n.substr(0,7)=="http://")?!0:n.substr(0,8)=="https://"?!0:n.substr(0,6)=="ftp://"?!0:n.substr(0,7)=="file://"?!0:!1}function su(n){var i,t;if(!n||!nr(n.charAt(0)))return!1;for(i=0;i<n.length;i++)if(t=n.charAt(i),!d(t)&&t!="_"&&t!="-"&&t!=":"&&t!=".")return!1;return!0}function tr(n,t,i){for(var r=i-1,o,u,e;r>=t&&f(n.charAt(r));)r--;if(r<t||n.charAt(r)!="}")return null;for(o=r,r--;r>=t&&n.charAt(r)!="{";)r--;if(r<t||n.charAt(r+1)!="#"||(u=r+2,e=n.substr(u,o-u),!su(e)))return null;while(r>t&&f(n.charAt(r-1)))r--;return{id:e,end:r}}function ir(n,t){return n.substr(0,t.length)==t}function hu(n,t){return n.substr(-t.length)==t}function ni(n){return n.indexOf("://")>=0||ir(n,"mailto:")}function v(){this.m_content=[]}function et(){this.reset.apply(this,arguments)}function g(n){this.name=n;this.attributes={};this.flags=0;this.closed=!1;this.closing=!1}function er(n){return n=n.toLowerCase(),n.substr(0,7)=="http://"||n.substr(0,8)=="https://"||n.substr(0,6)=="ftp://"}function ot(n){var i=n.m_position,t=cu(n);return t!=null?t:(n.m_position=i,null)}function cu(n){var i,u,t,r;if(n.current()!="<")return null;if(n.SkipForward(1),n.SkipString("!--")&&(n.Mark(),n.Find("-->")))return i=new g("!"),i.attributes.content=n.Extract(),i.closed=!0,n.SkipForward(3),i;if(u=n.SkipChar("/"),n.Mark(),!n.SkipIdentifier())return null;if(t=new g(n.Extract()),t.closing=u,u)return n.current()!=">"?null:(n.SkipForward(1),t);while(!n.eof()){if(n.SkipWhitespace(),n.SkipString("/>"))return t.closed=!0,t;if(n.SkipChar(">"))return t;if(n.Mark(),!n.SkipIdentifier())return null;if(r=n.Extract(),n.SkipWhitespace(),n.SkipChar("="))if(n.SkipWhitespace(),n.SkipChar('"')){if(n.Mark(),!n.Find('"'))return null;t.attributes[r]=n.Extract();n.SkipForward(1)}else{for(n.Mark();!n.eof()&&!f(n.current())&&n.current()!=">"&&n.current()!="/";)n.SkipForward(1);n.eof()||(t.attributes[r]=n.Extract())}else t.attributes[r]=""}return null}function st(n,t,i){this.id=n;this.url=t;this.title=i==undefined?null:i}function yu(n,t){var r=n.m_position,i=pu(n,t);return i==null&&(n.m_position=r),i}function pu(n,t){var i,r;return(n.SkipWhitespace(),!n.SkipChar("["))?null:(n.Mark(),!n.Find("]"))?null:(i=n.Extract(),i.length==0)?null:n.SkipString("]:")?(r=or(n,i,t),n.SkipLinespace(),!n.eol())?null:r:null}function or(n,t,i){var r,s,u,e,h,c,o,l;if(n.SkipWhitespace(),n.eol())return null;if(r=new st(t),n.SkipChar("<")){for(n.Mark();n.current()!=">";){if(n.eof())return null;n.SkipEscapableChar(i)}if(s=n.Extract(),!n.SkipChar(">"))return null;r.url=it(p(s),i);n.SkipWhitespace()}else{for(n.Mark(),u=1;!n.eol();){if(e=n.current(),f(e))break;if(t==null)if(e=="(")u++;else if(e==")"&&(u--,u==0))break;n.SkipEscapableChar(i)}r.url=it(p(n.Extract()),i)}if(n.SkipLinespace(),n.current()==")")return r;h=n.eol();c=n.m_position;n.eol()&&(n.SkipEol(),n.SkipLinespace());switch(n.current()){case"'":case'"':o=n.current();break;case"(":o=")";break;default:return h?(n.m_position=c,r):null}for(n.SkipForward(1),n.Mark();;){if(n.eol())return null;if(n.current()==o){if(o!=")"){if(l=n.m_position,n.SkipForward(1),n.SkipLinespace(),t==null&&n.current()!=")"||t!=null&&!n.eol())continue;n.m_position=l}break}n.SkipEscapableChar(i)}return r.title=it(n.Extract(),i),n.SkipForward(1),r}function ht(n,t){this.def=n;this.link_text=t}function br(n,t,i){this.type=n;this.startOffset=t;this.length=i;this.data=null}function fi(n){this.m_Markdown=n;this.m_Scanner=new et;this.m_SpareTokens=[];this.m_DisableLinks=!1;this.m_Tokens=[]}function pi(){}function k(n,t){this.m_Markdown=n;this.m_parentType=i;this.m_bMarkdownInHtml=t}function gi(){this.m_Columns=[];this.m_Headers=null;this.m_Rows=[]}function nf(n){var t,r,u,i;if(n.SkipLinespace(),n.current()!="|"&&n.current()!=":"&&n.current()!="-")return null;for(t=null,n.SkipChar("|")&&(t=new gi,t.LeadingBar=!0);;){if(n.SkipLinespace(),n.current()=="|")return null;for(r=n.SkipChar(":");n.current()=="-";)n.SkipForward(1);if(u=n.SkipChar(":"),n.SkipLinespace(),i=gu,r&&u?i=ru:r?i=tu:u&&(i=iu),n.eol())return t==null?null:(t.m_Columns.push(i),t);if(!n.SkipChar("|"))return null;if(t==null&&(t=new gi),t.m_Columns.push(i),n.SkipLinespace(),n.eol())return t.TrailingBar=!0,t}}var n;a.prototype={SafeMode:!1,ExtraMode:!1,MarkdownInHtml:!1,AutoHeadingIDs:!1,UrlBaseLocation:null,UrlRootLocation:null,NewWindowForExternalLinks:!1,NewWindowForLocalLinks:!1,NoFollowLinks:!1,HtmlClassFootnotes:"footnotes",HtmlClassTitledImages:null,RenderingTitledImage:!1,FormatCodeBlockAttributes:null,FormatCodeBlock:null,ExtractHeadBlocks:!1,HeadBlockContent:""};n=a.prototype;a.prototype.GetListItems=function(n,t){for(var r=this.ProcessBlocks(n),u,e,f,s,o,i=0;i<r.length;i++){if(u=r[i],(u.blockType==ai||u.blockType==y||u.blockType==li)&&u.children){r=uu(r,i,1,u.children);i--;continue}if(t<u.lineStart)break}if((i--,i<0)||(e=r[i],e.blockType!=ci&&e.blockType!=hi))return null;for(f=[],s=e.children,o=0;o<s.length;o++)f.push(s[o].lineStart);return i++,i<r.length?f.push(r[i].lineStart):f.push(n.length),f};a.prototype.Transform=function(n){var c=n.indexOf("\r"),o,s,e,l,t,a,u,f,h,i;if(c>=0&&(o=n.indexOf("\n"),o>=0&&(n=o<c?n.replace(/\n\r/g,"\n"):n.replace(/\r\n/g,"\n")),n=n.replace(/\r/g,"\n")),this.HeadBlockContent="",s=this.ProcessBlocks(n),this.m_Abbreviations!=null){e=[];for(l in this.m_Abbreviations)e.push(this.m_Abbreviations[l]);e.sort(function(n,t){return t.Abbr.length-n.Abbr.length});this.m_Abbreviations=e}for(t=this.m_StringBuilderFinal,t.Clear(),u=0;u<s.length;u++)a=s[u],a.Render(this,t);if(this.m_UsedFootnotes.length>0){for(t.Append('\n<div class="'),t.Append(this.HtmlClassFootnotes),t.Append('">\n'),t.Append("<hr />\n"),t.Append("<ol>\n"),u=0;u<this.m_UsedFootnotes.length;u++)f=this.m_UsedFootnotes[u],t.Append('<li id="fn:'),t.Append(f.data),t.Append('">\n'),h='<a href="#fnref:'+f.data+'" rev="footnote">&#8617;<\/a>',i=f.children[f.children.length-1],i.blockType==r?(i.blockType=yi,i.data=h):(i=new pi,i.contentLen=0,i.blockType=yi,i.data=h,f.children.push(i)),f.Render(this,t),t.Append("<\/li>\n");t.Append("<\/ol>\n");t.Append("<\/div>\n")}return t.ToString()};a.prototype.OnQualifyUrl=function(n){var i,t;if(ni(n))return n;if(ir(n,"/")){if(i=this.UrlRootLocation,!i){if(!this.UrlBaseLocation)return n;t=this.UrlBaseLocation.indexOf("://");t==-1?t=0:t+=3;t=this.UrlBaseLocation.indexOf("/",t);i=t<0?this.UrlBaseLocation:this.UrlBaseLocation.substr(0,t)}return i+n}return this.UrlBaseLocation?hu(this.UrlBaseLocation,"/")?this.UrlBaseLocation+n:this.UrlBaseLocation+"/"+n:n};a.prototype.OnGetImageSize=function(){return null};a.prototype.OnPrepareLink=function(n){var t=n.attributes.href;this.NoFollowLinks&&(n.attributes.rel="nofollow");(this.NewWindowForExternalLinks&&ni(t)||this.NewWindowForLocalLinks&&!ni(t))&&(n.attributes.target="_blank");n.attributes.href=this.OnQualifyUrl(t)};a.prototype.OnPrepareImage=function(n,t){var i=this.OnGetImageSize(n.attributes.src,t);i!=null&&(n.attributes.width=i.width,n.attributes.height=i.height);n.attributes.src=this.OnQualifyUrl(n.attributes.src)};a.prototype.GetLinkDefinition=function(n){var t=this.m_LinkDefinitions[n];return t==undefined?null:t};n.ProcessBlocks=function(n){return this.m_LinkDefinitions=[],this.m_Footnotes=[],this.m_UsedFootnotes=[],this.m_UsedHeaderIDs=[],this.m_Abbreviations=null,new k(this,this.MarkdownInHtml).Process(n)};n.AddLinkDefinition=function(n){this.m_LinkDefinitions[n.id]=n};n.AddFootnote=function(n){this.m_Footnotes[n.data]=n};n.ClaimFootnote=function(n){var t=this.m_Footnotes[n];return t!=undefined?(this.m_UsedFootnotes.push(t),delete this.m_Footnotes[n],this.m_UsedFootnotes.length-1):-1};n.AddAbbreviation=function(n,t){this.m_Abbreviations==null&&(this.m_Abbreviations=[]);this.m_Abbreviations[n]={Abbr:n,Title:t}};n.GetAbbreviations=function(){return this.m_Abbreviations};n.MakeUniqueHeaderID=function(n,t,i){var r,u,f;if(!this.AutoHeadingIDs)return null;for(r=this.m_SpanFormatter.MakeID(n,t,i),r||(r="section"),u=r,f=1;this.m_UsedHeaderIDs[u]!=undefined;)u=r+"-"+f.toString(),f++;return this.m_UsedHeaderIDs[u]=!0,u};n.GetStringBuilder=function(){return this.m_StringBuilder.Clear(),this.m_StringBuilder};n=v.prototype;n.Append=function(n){n&&this.m_content.push(n)};n.Clear=function(){this.m_content.length=0};n.ToString=function(){return this.m_content.join("")};n.HtmlRandomize=function(n){for(var i,r=n.length,t=0;t<r;t++)i=Math.random(),i>.9&&n.charAt(t)!="@"?this.Append(n.charAt(t)):i>.45?(this.Append("&#"),this.Append(n.charCodeAt(t).toString()),this.Append(";")):(this.Append("&#x"),this.Append(n.charCodeAt(t).toString(16)),this.Append(";"))};n.HtmlEncode=function(n,t,i){for(var f=t+i,r=t,u=t;u<f;u++)switch(n.charAt(u)){case"&":u>r&&this.Append(n.substr(r,u-r));this.Append("&amp;");r=u+1;break;case"<":u>r&&this.Append(n.substr(r,u-r));this.Append("&lt;");r=u+1;break;case">":u>r&&this.Append(n.substr(r,u-r));this.Append("&gt;");r=u+1;break;case'"':u>r&&this.Append(n.substr(r,u-r));this.Append("&quot;");r=u+1}u>r&&this.Append(n.substr(r,u-r))};n.SmartHtmlEncodeAmpsAndAngles=function(n,t,i){for(var e=t+i,u=t,f,r=t;r<e;r++)switch(n.charAt(r)){case"&":f=gt(n,r);f<0?(r>u&&this.Append(n.substr(u,r-u)),this.Append("&amp;"),u=r+1):r=f-1;break;case"<":r>u&&this.Append(n.substr(u,r-u));this.Append("&lt;");u=r+1;break;case">":r>u&&this.Append(n.substr(u,r-u));this.Append("&gt;");u=r+1;break;case'"':r>u&&this.Append(n.substr(u,r-u));this.Append("&quot;");u=r+1}r>u&&this.Append(n.substr(u,r-u))};n.SmartHtmlEncodeAmps=function(n,t,i){for(var e=t+i,u=t,f,r=t;r<e;r++)switch(n.charAt(r)){case"&":f=gt(n,r);f<0?(r>u&&this.Append(n.substr(u,r-u)),this.Append("&amp;"),u=r+1):r=f-1}r>u&&this.Append(n.substr(u,r-u))};n.HtmlEncodeAndConvertTabsToSpaces=function(n,t,i){for(var e=t+i,r=t,f=0,u=t;u<e;u++){switch(n.charAt(u)){case"\t":for(u>r&&this.Append(n.substr(r,u-r)),r=u+1,this.Append(" "),f++;f%4!=0;)this.Append(" "),f++;f--;break;case"\r":case"\n":u>r&&this.Append(n.substr(r,u-r));this.Append("\n");r=u+1;continue;case"&":u>r&&this.Append(n.substr(r,u-r));this.Append("&amp;");r=u+1;break;case"<":u>r&&this.Append(n.substr(r,u-r));this.Append("&lt;");r=u+1;break;case">":u>r&&this.Append(n.substr(r,u-r));this.Append("&gt;");r=u+1;break;case'"':u>r&&this.Append(n.substr(r,u-r));this.Append("&quot;");r=u+1}f++}u>r&&this.Append(n.substr(r,u-r))};n=et.prototype;n.bof=function(){return this.m_position==this.start};n.eof=function(){return this.m_position>=this.end};n.eol=function(){if(this.m_position>=this.end)return!0;var n=this.buf.charAt(this.m_position);return n=="\r"||n=="\n"||n==undefined||n==""};n.reset=function(){this.buf=arguments.length>0?arguments[0]:null;this.start=arguments.length>1?arguments[1]:0;this.end=arguments.length>2?this.start+arguments[2]:this.buf==null?0:this.buf.length;this.m_position=this.start;this.charset_offsets={}};n.current=function(){return this.m_position>=this.end?"\0":this.buf.charAt(this.m_position)};n.remainder=function(){return this.buf.substr(this.m_position)};n.SkipToEof=function(){this.m_position=this.end};n.SkipForward=function(n){this.m_position+=n};n.SkipToEol=function(){this.m_position=this.buf.indexOf("\n",this.m_position);this.m_position<0&&(this.m_position=this.end)};n.SkipEol=function(){var n=this.m_position;return this.buf.charAt(this.m_position)=="\r"&&this.m_position++,this.buf.charAt(this.m_position)=="\n"&&this.m_position++,this.m_position!=n};n.SkipToNextLine=function(){this.SkipToEol();this.SkipEol()};n.CharAtOffset=function(n){return this.m_position+n>=this.end?"\0":this.buf.charAt(this.m_position+n)};n.SkipChar=function(n){return this.buf.charAt(this.m_position)==n?(this.m_position++,!0):!1};n.SkipString=function(n){return this.buf.substr(this.m_position,n.length)==n?(this.m_position+=n.length,!0):!1};n.SkipWhitespace=function(){for(var t=this.m_position,n;;){if(n=this.buf.charAt(this.m_position),n!=" "&&n!="\t"&&n!="\r"&&n!="\n")break;this.m_position++}return this.m_position!=t};n.SkipLinespace=function(){for(var t=this.m_position,n;;){if(n=this.buf.charAt(this.m_position),n!=" "&&n!="\t")break;this.m_position++}return this.m_position!=t};n.FindRE=function(n){n.lastIndex=this.m_position;var t=n.exec(this.buf);return t==null?(this.m_position=this.end,!1):t.index+t[0].length>this.end?(this.m_position=this.end,!1):(this.m_position=t.index,!0)};n.FindOneOf=function(t){var r=-1,u,i;for(u in t)i=t[u],i==null&&(i={},i.m_searched_from=-1,i.m_found_at=-1,t[u]=i),(i.m_searched_from==-1||this.m_position<i.m_searched_from||this.m_position>=i.m_found_at&&i.m_found_at!=-1)&&(i.m_searched_from=this.m_position,i.m_found_at=this.buf.indexOf(u,this.m_position)),(r==-1||i.m_found_at<r)&&(r=i.m_found_at);return r==-1?(r=this.end,!1):(n.m_position=r,!0)};n.Find=function(n){return(this.m_position=this.buf.indexOf(n,this.m_position),this.m_position<0)?(this.m_position=this.end,!1):!0};n.Mark=function(){this.mark=this.m_position};n.Extract=function(){return this.mark>=this.m_position?"":this.buf.substr(this.mark,this.m_position-this.mark)};n.SkipIdentifier=function(){var n=this.buf.charAt(this.m_position);if(n>="a"&&n<="z"||n>="A"&&n<="Z"||n=="_")for(this.m_position++;;)if(n=this.buf.charAt(this.m_position),n>="a"&&n<="z"||n>="A"&&n<="Z"||n=="_"||n>="0"&&n<="9")this.m_position++;else return!0;return!1};n.SkipFootnoteID=function(){var i=this.m_position,n,t;for(this.SkipLinespace(),this.Mark();;)if(n=this.current(),d(n)||n=="-"||n=="_"||n==":"||n=="."||n==" ")this.SkipForward(1);else break;return this.m_position>this.mark&&(t=p(this.Extract()),t.length>0)?(this.SkipLinespace(),t):(this.m_position=i,null)};n.SkipHtmlEntity=function(){if(this.buf.charAt(this.m_position)!="&")return!1;var n=gt(this.buf,this.m_position);return n<0?!1:(this.m_position=n,!0)};n.SkipEscapableChar=function(n){return this.buf.charAt(this.m_position)=="\\"&&dt(this.buf.charAt(this.m_position+1),n)?(this.m_position+=2,!0):(this.m_position<this.end&&this.m_position++,!1)};var rr=1,ti=2,ur=4,fr=8;n=g.prototype;n.attributeCount=function(){var n,t;if(!this.attributes)return 0;n=0;for(t in this.attributes)n++;return n};n.get_Flags=function(){return this.flags==0&&(this.flags=vu[this.name.toLowerCase()],this.flags==undefined&&(this.flags=ti)),this.flags};n.IsSafe=function(){var t=this.name.toLowerCase(),n,i;if(!lu[t])return!1;if(n=au[t],!n)return this.attributeCount()==0;if(!this.attributes)return!0;for(i in this.attributes)if(!n[i.toLowerCase()])return!1;return this.attributes.href&&!er(this.attributes.href)?!1:this.attributes.src&&!er(this.attributes.src)?!1:!0};n.RenderOpening=function(n){n.Append("<");n.Append(this.name);for(var t in this.attributes)n.Append(" "),n.Append(t),n.Append('="'),n.Append(this.attributes[t]),n.Append('"');this.closed?n.Append(" />"):n.Append(">")};n.RenderClosing=function(n){n.Append("<\/");n.Append(this.name);n.Append(">")};var lu={b:1,blockquote:1,code:1,dd:1,dt:1,dl:1,del:1,em:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,i:1,kbd:1,li:1,ol:1,ul:1,p:1,pre:1,s:1,sub:1,sup:1,strong:1,strike:1,img:1,a:1},au={a:{href:1,title:1,"class":1},img:{src:1,width:1,height:1,alt:1,title:1,"class":1}},t=rr,w=ti,ii=ur,e=fr,vu={p:t|e,div:t,h1:t|e,h2:t|e,h3:t|e,h4:t|e,h5:t|e,h6:t|e,blockquote:t,pre:t,table:t,dl:t,ol:t,ul:t,form:t,fieldset:t,iframe:t,script:t|w,noscript:t|w,math:t|w,ins:t|w,del:t|w,img:t|w,li:e,dd:e,dt:e,td:e,th:e,legend:e,address:e,hr:t|ii,"!":t|ii,head:t};delete t;delete w;delete ii;n=st.prototype;n.RenderLink=function(n,t,i){if(this.url.substr(0,7).toLowerCase()=="mailto:")t.Append('<a href="'),t.HtmlRandomize(this.url),t.Append('"'),this.title&&(t.Append(' title="'),t.SmartHtmlEncodeAmpsAndAngles(this.title,0,this.title.length),t.Append('"')),t.Append(">"),t.HtmlRandomize(i),t.Append("<\/a>");else{var u=new g("a"),r=n.GetStringBuilder();r.SmartHtmlEncodeAmpsAndAngles(this.url,0,this.url.length);u.attributes.href=r.ToString();this.title&&(r.Clear(),r.SmartHtmlEncodeAmpsAndAngles(this.title,0,this.title.length),u.attributes.title=r.ToString());n.OnPrepareLink(u);u.RenderOpening(t);t.Append(i);t.Append("<\/a>")}};n.RenderImg=function(n,t,i){var u=new g("img"),r=n.GetStringBuilder();r.SmartHtmlEncodeAmpsAndAngles(this.url,0,this.url.length);u.attributes.src=r.ToString();i&&(r.Clear(),r.SmartHtmlEncodeAmpsAndAngles(i,0,i.length),u.attributes.alt=r.ToString());this.title&&(r.Clear(),r.SmartHtmlEncodeAmpsAndAngles(this.title,0,this.title.length),u.attributes.title=r.ToString());u.closed=!0;n.OnPrepareImage(u,n.RenderingTitledImage);u.RenderOpening(t)};var b=0,sr=1,ri=2,hr=3,cr=4,lr=5,ar=6,vr=7,yr=8,nt=9,ui=10,ct=11,lt=12,rt=13,pr=14,wr=15;n=fi.prototype;n.FormatParagraph=function(n,t,i,r){if(this.Tokenize(t,i,r),this.m_Tokens.length==1&&this.m_Markdown.HtmlClassTitledImages!=null&&this.m_Tokens[0].type==ui){var u=this.m_Tokens[0].data;n.Append('<div class="');n.Append(this.m_Markdown.HtmlClassTitledImages);n.Append('">\n');this.m_Markdown.RenderingTitledImage=!0;this.Render(n,t);this.m_Markdown.RenderingTitledImage=!1;n.Append("\n");u.def.title&&(n.Append("<p>"),n.SmartHtmlEncodeAmpsAndAngles(u.def.title,0,u.def.title.length),n.Append("<\/p>\n"));n.Append("<\/div>\n")}else n.Append("<p>"),this.Render(n,t),n.Append("<\/p>\n")};n.Format2=function(n,t){this.Format(n,t,0,t.length)};n.Format=function(n,t,i,r){this.Tokenize(t,i,r);this.Render(n,t)};n.FormatDirect=function(n){var t=new v;return this.Format(t,n,0,n.length),t.ToString()};n.MakeID=function(n,t,i){var s,r,o,e,u,f;for(this.Tokenize(n,t,i),s=this.m_Tokens,r=new v,o=0;o<s.length;o++){e=s[o];switch(e.type){case b:r.Append(n.substr(e.startOffset,e.length));break;case nt:r.Append(e.data.link_text)}this.FreeToken(e)}for(u=this.m_Scanner,u.reset(r.ToString());!u.eof();){if(nr(u.current()))break;u.SkipForward(1)}for(r.Clear();!u.eof();){if(f=u.current(),d(f)||f=="_"||f=="-"||f==".")r.Append(f.toLowerCase());else if(f==" ")r.Append("-");else if(bt(f)){r.Append("-");u.SkipEol();continue}u.SkipForward(1)}return r.ToString()};n.Render=function(n,t){for(var i,o,r,f,u,s=this.m_Tokens,h=s.length,e=0;e<h;e++){i=s[e];switch(i.type){case b:n.HtmlEncode(t,i.startOffset,i.length);break;case sr:n.SmartHtmlEncodeAmps(t,i.startOffset,i.length);break;case ri:case ct:case lt:case rt:n.Append(t.substr(i.startOffset,i.length));break;case yr:n.Append("<br />\n");break;case hr:n.Append("<em>");break;case cr:n.Append("<\/em>");break;case lr:n.Append("<strong>");break;case ar:n.Append("<\/strong>");break;case vr:n.Append("<code>");n.HtmlEncode(t,i.startOffset,i.length);n.Append("<\/code>");break;case nt:r=i.data;o=new fi(this.m_Markdown);o.m_DisableLinks=!0;r.def.RenderLink(this.m_Markdown,n,o.FormatDirect(r.link_text));break;case ui:r=i.data;r.def.RenderImg(this.m_Markdown,n,r.link_text);break;case pr:f=i.data;n.Append('<sup id="fnref:');n.Append(f.id);n.Append('"><a href="#fn:');n.Append(f.id);n.Append('" rel="footnote">');n.Append(f.index+1);n.Append("<\/a><\/sup>");break;case wr:u=i.data;n.Append("<abbr");u.Title&&(n.Append(' title="'),n.HtmlEncode(u.Title,0,u.Title.length),n.Append('"'));n.Append(">");n.HtmlEncode(u.Abbr,0,u.Abbr.length);n.Append("<\/abbr>")}this.FreeToken(i)}};n.Tokenize=function(n,t,i){var r=this.m_Scanner,o,c,u,y,l,f,p,w,a;r.reset(n,t,i);o=this.m_Tokens;o.length=0;for(var s=null,h=this.m_Markdown.GetAbbreviations(),v=h==null?/[\*\_\`\[\!\<\&\ \\]/g:null,k=this.m_Markdown.ExtraMode,e=r.m_position;!r.eof();){if(v!=null&&!r.FindRE(v))break;c=r.m_position;u=null;switch(r.current()){case"*":case"_":if(u=this.CreateEmphasisMark(),u!=null)switch(u.type){case rt:case ct:case lt:s==null&&(s=[]);s.push(u)}break;case"`":u=this.ProcessCodeSpan();break;case"[":case"!":y=r.m_position;u=this.ProcessLinkOrImageOrFootnote();u==null&&(r.m_position=y);break;case"<":f=r.m_position;l=ot(r);l!=null?!this.m_Markdown.SafeMode||l.IsSafe()?u=this.CreateToken(sr,f,r.m_position-f):r.m_position=f:(r.m_position=f,u=this.ProcessAutoLink(),u==null&&(r.m_position=f));break;case"&":f=r.m_position;r.SkipHtmlEntity()&&(u=this.CreateToken(ri,f,r.m_position-f));break;case" ":r.CharAtOffset(1)==" "&&bt(r.CharAtOffset(2))&&(r.SkipForward(2),r.eof()||(r.SkipEol(),u=this.CreateToken(yr,c,0)));break;case"\\":dt(r.CharAtOffset(1),k)&&(u=this.CreateToken(b,r.m_position+1,1),r.SkipForward(2))}if(u==null&&h!=null&&!d(r.CharAtOffset(-1))){p=r.m_position;for(w in h){if(a=h[w],r.SkipString(a.Abbr)&&!d(r.current())){u=this.CreateDataToken(wr,a);break}r.position=p}}u!=null?(c>e&&o.push(this.CreateToken(b,e,c-e)),o.push(u),e=r.m_position):r.SkipForward(1)}r.m_position>e&&o.push(this.CreateToken(b,e,r.m_position-e));s!=null&&this.ResolveEmphasisMarks(o,s)};n.CreateEmphasisMark=function(){var n=this.m_Scanner,i=n.current(),o=i=="*"?"_":"*",t=n.m_position,r,u,e;if(n.bof()||f(n.CharAtOffset(-1))){while(kt(n.current()))n.SkipForward(1);if(n.eof()||f(n.current()))return this.CreateToken(ri,t,n.m_position-t);n.m_position=t}while(kt(n.CharAtOffset(-1)))n.SkipForward(-1);for(r=n.bof()||f(n.CharAtOffset(-1)),n.m_position=t;n.current()==i;)n.SkipForward(1);for(u=n.m_position-t;kt(n.CharAtOffset(1));)n.SkipForward(1);return(e=n.eof()||f(n.current()),n.m_position=t+u,r)?this.CreateToken(ct,t,n.m_position-t):e?this.CreateToken(lt,t,n.m_position-t):this.m_Markdown.ExtraMode&&i=="_"?null:this.CreateToken(rt,t,n.m_position-t)};n.SplitMarkToken=function(n,t,i,r){var u=this.CreateToken(i.type,i.startOffset+r,i.length-r);return i.length=r,t.splice(ut(t,i)+1,0,u),n.splice(ut(n,i)+1,0,u),u};n.ResolveEmphasisMarks=function(n,t){for(var s=this.m_Scanner.buf,o=!0,f,i,e,u,r;o;)for(o=!1,f=0;f<t.length;f++)if(i=t[f],i.type==ct||i.type==rt)for(e=f+1;e<t.length;e++){if(u=t[e],u.type!=lt&&u.type!=rt)break;if(s.charAt(i.startOffset)==s.charAt(u.startOffset)){r=Math.min(i.length,u.length);r>=3&&(r=r%2==1?1:2);i.length>r&&(i=this.SplitMarkToken(n,t,i,i.length-r),f--);u.length>r&&this.SplitMarkToken(n,t,u,r);i.type=r==1?hr:lr;u.type=r==1?cr:ar;t.splice(ut(t,i),1);t.splice(ut(t,u),1);o=!0;break}}};n.ProcessAutoLink=function(){var t,r,u,n,i,e;if(this.m_DisableLinks)return null;for(t=this.m_Scanner,t.SkipForward(1),t.Mark(),r=this.m_Markdown.ExtraMode;!t.eof();){if(u=t.current(),f(u))break;if(u==">")return(n=it(t.Extract(),r),i=null,eu(n)?(n.toLowerCase().substr(0,7)=="mailto:"?e=n.substr(7):(e=n,n="mailto:"+n),i=new ht(new st("auto",n,null),e)):ou(n)&&(i=new ht(new st("auto",n,null),n)),i!=null)?(t.SkipForward(1),this.CreateDataToken(nt,i)):null;t.SkipEscapableChar(r)}return null};n.ProcessLinkOrImageOrFootnote=function(){var n=this.m_Scanner,u=n.SkipChar("!")?ui:nt,e,o,l,a,s,v,h,y,t,c,i,r,p;if(!n.SkipChar("["))return null;if(e=this.m_position,this.m_Markdown.ExtraMode&&u==nt&&n.SkipChar("^")){if(n.SkipLinespace(),n.Mark(),o=n.SkipFootnoteID(),o!=null&&n.SkipChar("]")&&(l=this.m_Markdown.ClaimFootnote(o),l>=0))return this.CreateDataToken(pr,{index:l,id:o});this.m_position=e}if(this.m_DisableLinks&&u==nt)return null;for(a=this.m_Markdown.ExtraMode,n.Mark(),s=1;!n.eof();){if(v=n.current(),v=="[")s++;else if(v=="]"&&(s--,s==0))break;n.SkipEscapableChar(a)}if(n.eof())return null;if(h=it(n.Extract(),a),n.SkipForward(1),e=n.m_position,n.SkipChar("("))return(y=or(n,null,this.m_Markdown.ExtraMode),y==null)?null:(n.SkipWhitespace(),!n.SkipChar(")"))?null:this.CreateDataToken(u,new ht(y,h));if(n.SkipChar(" ")||n.SkipChar("\t"),n.eol()&&(n.SkipEol(),n.SkipLinespace()),t=null,n.current()=="["){if(n.SkipForward(1),n.Mark(),!n.Find("]"))return null;t=n.Extract();n.SkipForward(1)}else n.m_position=e;if(!t)for(t=h;;){if(c=t.indexOf("\n"),c<0)break;for(i=c;i>0&&f(t.charAt(i-1));)i--;for(r=c;r<t.length&&f(t.charAt(r));)r++;t=t.substr(0,i)+" "+t.substr(r)}return(p=this.m_Markdown.GetLinkDefinition(t),p==null)?null:this.CreateDataToken(u,new ht(p,h))};n.ProcessCodeSpan=function(){for(var n=this.m_Scanner,t=n.m_position,i=0,r,u,e;n.SkipChar("`");)i++;if((n.SkipWhitespace(),n.eof())||(r=n.m_position,!n.Find(n.buf.substr(t,i))))return this.CreateToken(b,t,n.m_position-t);for(u=n.m_position+i;f(n.CharAtOffset(-1));)n.SkipForward(-1);return e=this.CreateToken(vr,r,n.m_position-r),n.m_position=u,e};n.CreateToken=function(n,t,i){if(this.m_SpareTokens.length!=0){var r=this.m_SpareTokens.pop();return r.type=n,r.startOffset=t,r.length=i,r.data=null,r}return new br(n,t,i)};n.CreateDataToken=function(n,t){var i;return this.m_SpareTokens.length!=0?(i=this.m_SpareTokens.pop(),i.type=n,i.data=t,i):(i=new br(n,0,0),i.data=t,i)};n.FreeToken=function(n){n.data=null;this.m_SpareTokens.push(n)};var i=0,tt=1,kr=2,wu=3,bu=4,ku=5,du=6,at=7,dr=8,s=9,h=10,o=11,r=12,l=13,ei=14,y=15,vt=16,oi=17,si=18,gr=19,hi=20,ci=21,li=22,ai=23,vi=24,u=25,yt=26,nu=27,c=28,yi=29;n=pi.prototype;n.buf=null;n.blockType=i;n.contentStart=0;n.contentLen=0;n.lineStart=0;n.lineLen=0;n.children=null;n.data=null;n.get_Content=function(){return this.buf==null?null:this.contentStart==-1?this.buf:this.buf.substr(this.contentStart,this.contentLen)};n.get_CodeContent=function(){for(var n=new v,t=0;t<this.children.length;t++)n.Append(this.children[t].get_Content()),n.Append("\n");return n.ToString()};n.RenderChildren=function(n,t){for(var i=0;i<this.children.length;i++)this.children[i].Render(n,t)};n.ResolveHeaderID=function(n){if(this.data!=null)return this.data;var i=tr(this.buf,this.contentStart,this.get_contentEnd()),t=null;return i!=null?(this.set_contentEnd(i.end),t=i.id):t=n.MakeUniqueHeaderID(this.buf,this.contentStart,this.contentLen),this.data=t,t};n.Render=function(n,t){var w,l,a,e,b,k,f,d;switch(this.blockType){case i:return;case r:n.m_SpanFormatter.FormatParagraph(t,this.buf,this.contentStart,this.contentLen);break;case oi:n.m_SpanFormatter.Format(t,this.buf,this.contentStart,this.contentLen);t.Append("\n");break;case tt:case kr:case wu:case bu:case ku:case du:n.ExtraMode&&!n.SafeMode?(t.Append("<h"+(this.blockType-tt+1).toString()),w=this.ResolveHeaderID(n),w?(t.Append(' id="'),t.Append(w),t.Append('">')):t.Append(">")):t.Append("<h"+(this.blockType-tt+1).toString()+">");n.m_SpanFormatter.Format(t,this.buf,this.contentStart,this.contentLen);t.Append("<\/h"+(this.blockType-tt+1).toString()+">\n");break;case ei:t.Append("<hr />\n");return;case h:case o:t.Append("<li>");n.m_SpanFormatter.Format(t,this.buf,this.contentStart,this.contentLen);t.Append("<\/li>\n");break;case y:t.Append(this.buf.substr(this.contentStart,this.contentLen));return;case vt:t.HtmlEncode(this.buf,this.contentStart,this.contentLen);return;case si:for(t.Append("<pre"),n.FormatCodeBlockAttributes!=null&&t.Append(n.FormatCodeBlockAttributes(this.data)),t.Append("><code>"),l=t,n.FormatCodeBlock&&(l=t,t=new v),f=0;f<this.children.length;f++)a=this.children[f],t.HtmlEncodeAndConvertTabsToSpaces(a.buf,a.contentStart,a.contentLen),t.Append("\n");n.FormatCodeBlock&&(l.Append(n.FormatCodeBlock(t.ToString(),this.data)),t=l);t.Append("<\/code><\/pre>\n\n");return;case s:t.Append("<blockquote>\n");this.RenderChildren(n,t);t.Append("<\/blockquote>\n");return;case gr:t.Append("<li>\n");this.RenderChildren(n,t);t.Append("<\/li>\n");return;case hi:t.Append("<ol>\n");this.RenderChildren(n,t);t.Append("<\/ol>\n");return;case ci:t.Append("<ul>\n");this.RenderChildren(n,t);t.Append("<\/ul>\n");return;case li:e=this.data;b=e.name.toLowerCase();b=="a"?n.OnPrepareLink(e):b=="img"&&n.OnPrepareImage(e,n.RenderingTitledImage);e.RenderOpening(t);t.Append("\n");this.RenderChildren(n,t);e.RenderClosing(t);t.Append("\n");return;case ai:case c:this.RenderChildren(n,t);return;case vi:this.data.Render(n,t);return;case u:t.Append("<dd>");this.children!=null?(t.Append("\n"),this.RenderChildren(n,t)):n.m_SpanFormatter.Format(t,this.buf,this.contentStart,this.contentLen);t.Append("<\/dd>\n");break;case yt:if(this.children==null)for(k=this.get_Content().split("\n"),f=0;f<k.length;f++)d=k[f],t.Append("<dt>"),n.m_SpanFormatter.Format2(t,p(d)),t.Append("<\/dt>\n");else t.Append("<dt>\n"),this.RenderChildren(n,t),t.Append("<\/dt>\n");break;case nu:t.Append("<dl>\n");this.RenderChildren(n,t);t.Append("<\/dl>\n");return;case yi:t.Append("<p>");this.contentLen>0&&(n.m_SpanFormatter.Format(t,this.buf,this.contentStart,this.contentLen),t.Append("&nbsp;"));t.Append(this.data);t.Append("<\/p>\n")}};n.RevertToPlain=function(){this.blockType=r;this.contentStart=this.lineStart;this.contentLen=this.lineLen};n.get_contentEnd=function(){return this.contentStart+this.contentLen};n.set_contentEnd=function(n){this.contentLen=n-this.contentStart};n.get_leadingSpaces=function(){for(var t=0,n=this.lineStart;n<this.lineStart+this.lineLen;n++)if(this.buf.charAt(n)==" ")t++;else break;return t};n.CopyFrom=function(n){return this.blockType=n.blockType,this.buf=n.buf,this.contentStart=n.contentStart,this.contentLen=n.contentLen,this.lineStart=n.lineStart,this.lineLen=n.lineLen,this};n=k.prototype;n.Process=function(n){var t=new et(n);return this.ScanLines(t)};n.ProcessRange=function(n,t,i){var r=new et(n,t,i);return this.ScanLines(r)};n.StartTable=function(n,t,i){var r,u;if(i.length>1)return!1;if(i.length==1){if(r=n.m_position,n.m_position=i[0].lineStart,t.m_Headers=t.ParseRow(n),t.m_Headers==null)return!1;n.m_position=r;i.length=0}for(;;){if(r=n.m_position,u=t.ParseRow(n),u!=null){t.m_Rows.push(u);continue}n.m_position=r;break}return!0};n.ScanLines=function(n){for(var e=[],f=[],y=-1,p,t,v,w,b,a;!n.eof();){if(p=y==i,t=this.EvaluateLine(n),y=t.blockType,t.blockType==u&&(t.data=p),t.blockType==at||t.blockType==dr){if(f.length>0&&(a=f.pop(),this.CollapseLines(e,f),a.blockType!=i)){a.RevertToPlain();a.blockType=t.blockType==at?tt:kr;e.push(a);continue}t.blockType==at?(t.RevertToPlain(),f.push(t)):t.contentLen>=3?(t.blockType=ei,e.push(t)):(t.RevertToPlain(),f.push(t));continue}if(v=f.length>0?f[0].blockType:i,t.blockType==vi)if(w=t.data,b=n.m_position,this.StartTable(n,w,f)){e.push(t);continue}else n.m_position=b,t.RevertToPlain();switch(t.blockType){case i:switch(v){case i:this.FreeBlock(t);break;case r:this.CollapseLines(e,f);this.FreeBlock(t);break;case s:case h:case o:case u:case c:case l:f.push(t)}break;case r:switch(v){case i:case r:f.push(t);break;case s:case h:case o:case u:case c:a=f[f.length-1];a.blockType==i?(this.CollapseLines(e,f),f.push(t)):f.push(t);break;case l:this.CollapseLines(e,f);f.push(t)}break;case l:switch(v){case i:f.push(t);break;case r:case s:a=f[f.length-1];a.blockType==i?(this.CollapseLines(e,f),f.push(t)):(t.RevertToPlain(),f.push(t));break;case h:case o:case l:case u:case c:f.push(t)}break;case s:v!=s&&this.CollapseLines(e,f);f.push(t);break;case h:case o:switch(v){case i:f.push(t);break;case r:case s:a=f[f.length-1];a.blockType==i||this.m_parentType==h||this.m_parentType==o||this.m_parentType==u?(this.CollapseLines(e,f),f.push(t)):(t.RevertToPlain(),f.push(t));break;case h:case o:t.blockType!=h&&t.blockType!=o&&this.CollapseLines(e,f);f.push(t);break;case u:case c:t.blockType!=v&&this.CollapseLines(e,f);f.push(t);break;case l:this.CollapseLines(e,f);f.push(t)}break;case u:case c:switch(v){case i:case r:case u:case c:this.CollapseLines(e,f);f.push(t);break;default:t.RevertToPlain();f.push(t)}break;default:this.CollapseLines(e,f);e.push(t)}}return this.CollapseLines(e,f),this.m_Markdown.ExtraMode&&this.BuildDefinitionLists(e),e};n.CreateBlock=function(n){var t;return t=this.m_Markdown.m_SpareBlocks.length>1?this.m_Markdown.m_SpareBlocks.pop():new pi,t.lineStart=n,t};n.FreeBlock=function(n){this.m_Markdown.m_SpareBlocks.push(n)};n.FreeBlocks=function(n){for(var t=0;t<n.length;t++)this.m_Markdown.m_SpareBlocks.push(n[t]);n.length=0};n.RenderLines=function(n){for(var t,i=this.m_Markdown.GetStringBuilder(),r=0;r<n.length;r++)t=n[r],i.Append(t.buf.substr(t.contentStart,t.contentLen)),i.Append("\n");return i.ToString()};n.CollapseLines=function(n,t){for(var f,d,b,p,v,y,e,a,w;t.length>0&&t[t.length-1].blockType==i;)this.FreeBlock(t.pop());if(t.length!=0)switch(t[0].blockType){case r:f=this.CreateBlock(t[0].lineStart);f.blockType=r;f.buf=t[0].buf;f.contentStart=t[0].contentStart;f.set_contentEnd(t[t.length-1].get_contentEnd());n.push(f);this.FreeBlocks(t);break;case s:d=this.RenderLines(t);b=new k(this.m_Markdown,this.m_bMarkdownInHtml);b.m_parentType=s;p=this.CreateBlock(t[0].lineStart);p.blockType=s;p.children=b.Process(d);this.FreeBlocks(t);n.push(p);break;case h:case o:n.push(this.BuildList(t));break;case u:if(n.length>0){v=n[n.length-1];switch(v.blockType){case r:v.blockType=yt;break;case u:break;default:y=this.CreateBlock(v.lineStart);y.blockType=yt;y.children=[];y.children.push(v);n.pop();n.push(y)}}n.push(this.BuildDefinition(t));break;case c:this.m_Markdown.AddFootnote(this.BuildFootnote(t));break;case l:for(e=this.CreateBlock(t[0].lineStart),e.blockType=si,e.children=[],a=t[0].get_Content(),a.substr(0,2)=="{{"&&a.substr(a.length-2,2)=="}}"&&(e.data=a.substr(2,a.length-4),t.splice(0,1)),w=0;w<t.length;w++)e.children.push(t[w]);n.push(e);t.length=0}};n.EvaluateLine=function(n){var t=this.CreateBlock(n.m_position);return t.buf=n.buf,t.contentStart=n.m_position,t.contentLen=-1,t.blockType=this.EvaluateLineInternal(n,t),t.contentLen<0&&(n.SkipToEol(),t.contentLen=n.m_position-t.contentStart),t.lineLen=n.m_position-t.lineStart,n.SkipEol(),t};n.EvaluateLineInternal=function(n,t){var v,e,y,w,k,a,d,g,b,nt,ut,et,it,rt;if(n.eol())return i;if(v=n.m_position,e=n.current(),e=="#"){for(y=1,n.SkipForward(1);n.current()=="#";)y++,n.SkipForward(1);for(y>6&&(y=6),n.SkipLinespace(),t.contentStart=n.m_position,n.SkipToEol(),this.m_Markdown.ExtraMode&&!this.m_Markdown.SafeMode&&(w=tr(n.buf,t.contentStart,n.m_position),w!=null&&(t.data=w.id,n.m_position=w.end));n.m_position>t.contentStart&&n.CharAtOffset(-1)=="#";)n.SkipForward(-1);while(n.m_position>t.contentStart&&f(n.CharAtOffset(-1)))n.SkipForward(-1);return t.contentLen=n.m_position-t.contentStart,n.SkipToEol(),tt+(y-1)}if(e=="-"||e=="="){for(b=e;n.current()==b;)n.SkipForward(1);if(n.SkipLinespace(),n.eol())return b=="="?at:dr;n.m_position=v}if(this.m_Markdown.ExtraMode){if(k=nf(n),k!=null)return t.data=k,vi;if(n.m_position=v,e=="~"){if(this.ProcessFencedCodeBlock(n,t))return t.blockType;n.m_position=v}}for(a=-1,d=0;!n.eol();){if(n.current()==" ")a<0&&d++;else if(n.current()=="\t")a<0&&(a=n.m_position);else break;n.SkipForward(1)}if(n.eol())return t.contentLen=0,i;if(d>=4)return t.contentStart=v+4,l;if(a>=0&&a-v<4)return t.contentStart=a+1,l;if(t.contentStart=n.m_position,e=n.current(),e=="<"){if(this.ScanHtml(n,t))return t.blockType;n.m_position=t.contentStart}if(e==">")return ft(n.CharAtOffset(1))?(n.SkipForward(2),t.contentStart=n.m_position,s):(n.SkipForward(1),t.contentStart=n.m_position,s);if(e=="-"||e=="_"||e=="*"){for(g=0;!n.eol();){if(b=n.current(),n.current()==e){g++;n.SkipForward(1);continue}if(ft(n.current())){n.SkipForward(1);continue}break}if(n.eol()&&g>=3)return ei;n.m_position=t.contentStart}if(this.m_Markdown.ExtraMode&&e=="*"&&n.CharAtOffset(1)=="["){for(n.SkipForward(2),n.SkipLinespace(),n.Mark();!n.eol()&&n.current()!="]";)n.SkipForward(1);if(nt=p(n.Extract()),n.current()=="]"&&n.CharAtOffset(1)==":"&&nt)return n.SkipForward(2),n.SkipLinespace(),n.Mark(),n.SkipToEol(),ut=n.Extract(),this.m_Markdown.AddAbbreviation(nt,ut),i;n.m_position=t.contentStart}if((e=="*"||e=="+"||e=="-")&&ft(n.CharAtOffset(1)))return n.SkipForward(1),n.SkipLinespace(),t.contentStart=n.m_position,o;if(e==":"&&this.m_Markdown.ExtraMode&&ft(n.CharAtOffset(1)))return n.SkipForward(1),n.SkipLinespace(),t.contentStart=n.m_position,u;if(wt(e)){for(n.SkipForward(1);wt(n.current());)n.SkipForward(1);if(n.SkipChar(".")&&n.SkipLinespace())return t.contentStart=n.m_position,h;n.m_position=t.contentStart}if(e=="["){if(this.m_Markdown.ExtraMode&&n.CharAtOffset(1)=="^"){if(et=n.m_position,n.SkipForward(2),it=n.SkipFootnoteID(),it!=null&&n.SkipChar("]")&&n.SkipChar(":"))return n.SkipLinespace(),t.contentStart=n.m_position,t.data=it,c;n.m_position=et}if(rt=yu(n,this.m_Markdown.ExtraMode),rt!=null)return this.m_Markdown.AddLinkDefinition(rt),i}return r};var wi=0,bi=1,ki=2,pt=3,di=4;n.GetMarkdownMode=function(n){var t=n.attributes.markdown;return t==undefined?this.m_bMarkdownInHtml?pt:wi:(delete n.attributes.markdown,t=="1")?(n.get_Flags()&fr)!=0?ki:bi:t=="block"?bi:t=="deep"?pt:t=="span"?ki:di};n.ProcessMarkdownEnabledHtml=function(n,t,i,r){for(var f=n.m_position,s=1,h=!1,o,e,c,u;!n.eof();){if(!n.Find("<"))break;if(o=n.m_position,e=ot(n),e==null){n.SkipForward(1);continue}if((this.m_Markdown.SafeMode&&r==di&&!h&&(e.IsSafe()||(h=!0)),!e.closed)&&e.name==i.name)if(e.closing){if(s--,s==0){n.SkipLinespace();n.SkipEol();t.blockType=li;t.data=i;t.set_contentEnd(n.m_position);switch(r){case ki:u=this.CreateBlock(f);u.buf=n.buf;u.blockType=oi;u.contentStart=f;u.contentLen=o-f;t.children=[];t.children.push(u);break;case bi:case pt:c=new k(this.m_Markdown,r==pt);t.children=c.ProcessRange(n.buf,f,o-f);break;case di:h?(t.blockType=vt,t.set_contentEnd(n.m_position)):(u=this.CreateBlock(f),u.buf=n.buf,u.blockType=y,u.contentStart=f,u.contentLen=o-f,t.children=[],t.children.push(u))}return!0}}else s++}return!1};n.ScanHtml=function(n,t){var u=n.m_position,e=ot(n),s,c,l,b,o,a,v,f,h,w,r,k;if(e==null||e.closing||(s=!1,this.m_Markdown.SafeMode&&!e.IsSafe()&&(s=!0),c=e.get_Flags(),(c&rr)==0))return!1;if((c&ur)!=0||e.closed)return n.SkipLinespace(),n.SkipEol(),t.contentLen=n.m_position-t.contentStart,t.blockType=s?vt:y,!0;if((c&ti)!=0&&(n.SkipLinespace(),!n.eol()))return!1;if(l=this.m_Markdown.ExtractHeadBlocks&&e.name.toLowerCase()=="head",b=n.m_position,!l&&this.m_Markdown.ExtraMode&&(h=this.GetMarkdownMode(e),h!=wi))return this.ProcessMarkdownEnabledHtml(n,t,e,h);for(o=null,a=1;!n.eof();){if(!n.Find("<"))break;if(v=n.m_position,f=ot(n),f==null){n.SkipForward(1);continue}if(this.m_Markdown.SafeMode&&!f.IsSafe()&&(s=!0),!f.closed){if(!l&&!f.closing&&this.m_Markdown.ExtraMode&&!s&&(h=this.GetMarkdownMode(f),h!=wi))if(w=this.CreateBlock(u),this.ProcessMarkdownEnabledHtml(n,w,f,h)){o==null&&(o=[]);v>u&&(r=this.CreateBlock(u),r.buf=n.buf,r.blockType=y,r.contentStart=u,r.contentLen=v-u,o.push(r));o.push(w);u=n.m_position;continue}else this.FreeBlock(w);if(f.name==e.name&&!f.closed)if(f.closing){if(a--,a==0)return(n.SkipLinespace(),n.SkipEol(),s)?(t.blockType=vt,t.set_contentEnd(n.m_position),!0):o!=null?(n.m_position>u&&(r=this.CreateBlock(u),r.buf=n.buf,r.blockType=y,r.contentStart=u,r.contentLen=n.m_position-u,o.push(r)),t.blockType=ai,t.set_contentEnd(n.m_position),t.children=o,!0):l?(k=n.buf.substr(b,v-b),this.m_Markdown.HeadBlockContent=this.m_Markdown.HeadBlockContent+p(k)+"\n",t.blockType=y,t.contentStart=n.position,t.contentEnd=n.position,t.lineStart=n.position,!0):(t.blockType=y,t.contentLen=n.m_position-t.contentStart,!0)}else a++}}return i};n.BuildList=function(n){for(var y,g,f,s,e,p,a,v,c,w,u,b,d=n[0].blockType,nt=n[0].get_leadingSpaces(),t=1;t<n.length;t++){if(n[t].blockType==r&&(n[t-1].blockType==r||n[t-1].blockType==o||n[t-1].blockType==h)){n[t-1].set_contentEnd(n[t].get_contentEnd());this.FreeBlock(n[t]);n.splice(t,1);t--;continue}n[t].blockType!=l&&n[t].blockType!=i&&(y=n[t].get_leadingSpaces(),y>nt&&(n[t].blockType=l,g=n[t].get_contentEnd(),n[t].contentStart=n[t].lineStart+y,n[t].set_contentEnd(g)))}for(f=this.CreateBlock(0),f.blockType=d==o?ci:hi,f.children=[],t=0;t<n.length;t++){for(s=t;s>0&&n[s-1].blockType==i;)s--;for(e=t;e<n.length-1&&n[e+1].blockType!=o&&n[e+1].blockType!=h;)e++;if(s==e)f.children.push(this.CreateBlock().CopyFrom(n[t]));else{for(p=!1,a=this.m_Markdown.GetStringBuilder(),u=s;u<=e;u++)v=n[u],a.Append(v.buf.substr(v.contentStart,v.contentLen)),a.Append("\n"),n[u].blockType==i&&(p=!0);if(c=this.CreateBlock(),c.blockType=gr,c.lineStart=n[s].lineStart,w=new k(this.m_Markdown),w.m_parentType=d,c.children=w.Process(a.ToString()),!p)for(u=0;u<c.children.length;u++)b=c.children[u],b.blockType==r&&(b.blockType=oi);f.children.push(c)}t=e}return f.lineStart=f.children[0].lineStart,this.FreeBlocks(n),n.length=0,f};n.BuildDefinition=function(n){for(var s,h,i,f,e,o,t=1;t<n.length;t++)if(n[t].blockType==r&&(n[t-1].blockType==r||n[t-1].blockType==u)){n[t-1].set_contentEnd(n[t].get_contentEnd());this.FreeBlock(n[t]);n.splice(t,1);t--;continue}if(s=n[0].data,n.length==1&&!s)return h=n[0],n.length=0,h;for(i=this.m_Markdown.GetStringBuilder(),t=0;t<n.length;t++)f=n[t],i.Append(f.buf.substr(f.contentStart,f.contentLen)),i.Append("\n");return e=this.CreateBlock(n[0].lineStart),e.blockType=u,o=new k(this.m_Markdown),o.m_parentType=u,e.children=o.Process(i.ToString()),this.FreeBlocks(n),n.length=0,e};n.BuildDefinitionLists=function(n){for(var i=null,t=0;t<n.length;t++)switch(n[t].blockType){case yt:case u:i==null&&(i=this.CreateBlock(n[t].lineStart),i.blockType=nu,i.children=[],n.splice(t,0,i),t++);i.children.push(n[t]);n.splice(t,1);t--;break;default:i=null}};n.BuildFootnote=function(n){for(var u,f,e,i,t=1;t<n.length;t++)if(n[t].blockType==r&&(n[t-1].blockType==r||n[t-1].blockType==c)){n[t-1].set_contentEnd(n[t].get_contentEnd());this.FreeBlock(n[t]);n.splice(t,1);t--;continue}for(u=this.m_Markdown.GetStringBuilder(),t=0;t<n.length;t++)f=n[t],u.Append(f.buf.substr(f.contentStart,f.contentLen)),u.Append("\n");return e=new k(this.m_Markdown),e.m_parentType=c,i=this.CreateBlock(n[0].lineStart),i.blockType=c,i.data=n[0].data,i.children=e.Process(u.ToString()),this.FreeBlocks(n),n.length=0,i};n.ProcessFencedCodeBlock=function(n,t){var e=n.m_position,r,u,f,i;for(n.Mark();n.current()=="~";)n.SkipForward(1);return(r=n.Extract(),r.length<3)?!1:(n.SkipLinespace(),!n.eol())?!1:(n.SkipEol(),u=n.m_position,!n.Find(r))?!1:bt(n.CharAtOffset(-1))?(f=n.m_position,n.SkipForward(r.length),n.SkipLinespace(),!n.eol())?!1:(t.blockType=si,t.children=[],f--,i=this.CreateBlock(e),i.blockType=l,i.buf=n.buf,i.contentStart=u,i.contentLen=f-u,t.children.push(i),!0):!1};var gu=0,tu=1,iu=2,ru=3;n=gi.prototype;n.LeadingBar=!1;n.TrailingBar=!1;n.ParseRow=function(n){var i,t;if(n.SkipLinespace(),n.eol())return null;if(i=this.LeadingBar,this.LeadingBar&&!n.SkipChar("|"))return i=!0,null;for(t=[];!n.eol();){for(n.Mark();!n.eol()&&n.current()!="|";)n.SkipForward(1);t.push(p(n.Extract()));i|=n.SkipChar("|")}if(!i)return null;while(t.length<this.m_Columns.length)t.push("&nbsp;");return n.SkipEol(),t};n.RenderRow=function(n,t,i,r){for(var u=0;u<i.length;u++){if(t.Append("\t<"),t.Append(r),u<this.m_Columns.length)switch(this.m_Columns[u]){case tu:t.Append(' align="left"');break;case iu:t.Append(' align="right"');break;case ru:t.Append(' align="center"')}t.Append(">");n.m_SpanFormatter.Format2(t,i[u]);t.Append("<\/");t.Append(r);t.Append(">\n")}};n.Render=function(n,t){var i,r;for(t.Append("<table>\n"),this.m_Headers!=null&&(t.Append("<thead>\n<tr>\n"),this.RenderRow(n,t,this.m_Headers,"th"),t.Append("<\/tr>\n<\/thead>\n")),t.Append("<tbody>\n"),i=0;i<this.m_Rows.length;i++)r=this.m_Rows[i],t.Append("<tr>\n"),this.RenderRow(n,t,r,"td"),t.Append("<\/tr>\n");t.Append("<\/tbody>\n");t.Append("<\/table>\n")};this.Markdown=a;this.HtmlTag=g},MarkdownDeepEditor=new function(){function u(n,t){return n.substr(0,t.length)==t}function ht(n,t){return n.substr(-t.length)==t}function i(n){return n==" "||n=="\t"||n=="\r"||n=="\n"}function r(n){return n=="\r"||n=="\n"}function f(n){for(var t=0,r=n.length;t<r&&i(n.charAt(t));)t++;while(r-1>t&&i(n.charAt(r-1)))r--;return n.substr(t,r-t)}function e(n,t,i){n.addEventListener?n.addEventListener(t,i,!1):n.attachEvent&&n.attachEvent("on"+t,i)}function w(n){return n.preventDefault&&n.preventDefault(),n.cancelBubble!==undefined&&(n.cancelBubble=!0,n.keyCode=0,n.returnValue=!1),!1}function o(){}function b(n,t,i,r){return n<t?n:n<t+i?t:n+r-i}function a(n,t){n.setSelectionRange||(s=!0);this.m_lastContent=null;this.m_undoStack=[];this.m_undoPos=0;this.m_undoMode=l;this.Markdown=new MarkdownDeep.Markdown;this.Markdown.SafeMode=!1;this.Markdown.ExtraMode=!0;this.Markdown.NewWindowForLocalLinks=!0;this.Markdown.NewWindowForExternalLinks=!0;this.m_textarea=n;this.m_divHtml=t;var i=this;e(n,"keyup",function(){i.onMarkdownChanged()});e(n,"keydown",function(n){return i.onKeyDown(n)});e(n,"paste",function(){i.onMarkdownChanged()});e(n,"input",function(){i.onMarkdownChanged()});e(n,"mousedown",function(){i.SetUndoMode(l)});this.onMarkdownChanged()}var s=!1,k=9,v=13,d=33,g=34,nt=36,tt=35,it=37,rt=39,ut=38,ft=40,et=8,ot=46,h=0,c=1,y=2,l=3,st=4,p={Z:"undo",Y:"redo",B:"bold",I:"italic",H:"heading",K:"code",U:"ullist",O:"ollist",Q:"indent",E:"outdent",L:"link",G:"img",R:"hr","0":"h0","1":"h1","2":"h2","3":"h3","4":"h4","5":"h5","6":"h6"},n,t;n=o.prototype;n.InitFromTextArea=function(n){var t,i,r;this.m_textarea=n;s?(t=document.selection.createRange(),i=t.duplicate(),i.moveToElementText(n),r=-i.moveStart("character",-1e7),this.m_selectionStart=-t.moveStart("character",-1e7)-r,this.m_selectionEnd=-t.moveEnd("character",-1e7)-r,this.m_text=n.value.replace(/\r\n/gm,"\n")):(this.m_selectionStart=n.selectionStart,this.m_selectionEnd=n.selectionEnd,this.m_text=n.value)};n.Duplicate=function(){var n=new o;return n.m_textarea=this.m_textarea,n.m_selectionEnd=this.m_selectionEnd,n.m_selectionStart=this.m_selectionStart,n.m_text=this.m_text,n};n.Apply=function(){var n,t;s?(this.m_textarea.value=this.m_text,this.m_textarea.focus(),n=this.m_textarea.createTextRange(),n.collapse(!0),n.moveEnd("character",this.m_selectionEnd),n.moveStart("character",this.m_selectionStart),n.select()):(t=this.m_textarea.scrollTop,this.m_textarea.value=this.m_text,this.m_textarea.focus(),this.m_textarea.setSelectionRange(this.m_selectionStart,this.m_selectionEnd),this.m_textarea.scrollTop=t)};n.ReplaceSelection=function(n){this.m_text=this.m_text.substr(0,this.m_selectionStart)+n+this.m_text.substr(this.m_selectionEnd);this.m_selectionEnd=this.m_selectionStart+n.length};n.ReplaceAt=function(n,t,i){this.m_text=this.m_text.substr(0,n)+i+this.m_text.substr(n+t);this.m_selectionStart=b(this.m_selectionStart,n,t,i.length);this.m_selectionEnd=b(this.m_selectionEnd,n,t,i.length)};n.getSelectedText=function(){return this.m_text.substr(this.m_selectionStart,this.m_selectionEnd-this.m_selectionStart)};n.InflateSelection=function(n,t){this.m_selectionEnd+=t;this.m_selectionStart-=n};n.PreceededBy=function(n){return this.m_selectionStart>=n.length&&this.m_text.substr(this.m_selectionStart-n.length,n.length)==n};n.FollowedBy=function(n){return this.m_text.substr(this.m_selectionEnd,n.length)==n};n.TrimSelection=function(){while(i(this.m_text.charAt(this.m_selectionStart)))this.m_selectionStart++;while(this.m_selectionEnd>this.m_selectionStart&&i(this.m_text.charAt(this.m_selectionEnd-1)))this.m_selectionEnd--};n.IsStartOfLine=function(n){return n==0||r(this.m_text.charAt(n-1))};n.FindStartOfLine=function(n){while(n>0&&!r(this.m_text.charAt(n-1)))n--;return n};n.FindEndOfLine=function(n){while(n<this.m_text.length&&!r(this.m_text.charAt(n)))n++;return n};n.FindNextLine=function(n){return this.SkipEol(this.FindEndOfLine(n))};n.SkipWhiteSpace=function(n){while(n<this.m_text.length&&i(this.m_text.charAt(n)))n++;return n};n.SkipEol=function(n){return this.m_text.substr(n,2)=="\r\n"?n+2:r(this.m_text.charAt(n))?n+1:n};n.SkipPreceedingEol=function(n){return n>2&&this.m_text.substr(n-2,2)=="\r\n"?n-2:n>1&&r(this.m_text.charAt(n-1))?n-1:n};n.SelectWholeLines=function(){this.m_selectionStart=this.FindStartOfLine(this.m_selectionStart);this.IsStartOfLine(this.m_selectionEnd)||(this.m_selectionEnd=this.SkipEol(this.FindEndOfLine(this.m_selectionEnd)))};n.SkipPreceedingWhiteSpace=function(n){while(n>0&&i(this.m_text.charAt(n-1)))n--;return n};n.SkipFollowingWhiteSpace=function(n){while(i(this.m_text.charAt(n)))n++;return n};n.SelectSurroundingWhiteSpace=function(){this.m_selectionStart=this.SkipPreceedingWhiteSpace(this.m_selectionStart);this.m_selectionEnd=this.SkipFollowingWhiteSpace(this.m_selectionEnd)};n.CheckSimpleSelection=function(){var n=this.getSelectedText(),t=n.match(/\n[ \t\r]*\n/);return t?(alert("Please make a selection that doesn't include a paragraph break"),!1):!0};n.IsBlankLine=function(n){for(var u,f=this.m_text.length,t=n;t<f;t++){if(u=this.m_text[t],r(u))return!0;if(!i(this.m_text.charAt(t)))return!1}return!0};n.FindStartOfParagraph=function(n){var i=n,t;if(n=this.FindStartOfLine(n),this.IsBlankLine(n))return n;while(n>0){if(t=this.FindStartOfLine(this.SkipPreceedingEol(n)),t==0)break;if(this.IsBlankLine(t))break;n=t}if(this.DetectListType(n).m_prefixLen!=0)for(n=this.FindStartOfLine(i);n>0;){if(this.DetectListType(n).m_prefixLen!=0)return n;n=this.FindStartOfLine(this.SkipPreceedingEol(n))}return n};n.FindEndOfParagraph=function(n){while(n<this.m_text.length){if(this.IsBlankLine(n))break;n=this.FindNextLine(n)}return n};n.SelectParagraph=function(){this.m_selectionStart=this.FindStartOfParagraph(this.m_selectionStart);this.m_selectionEnd=this.FindEndOfParagraph(this.m_selectionStart)};n.DetectListType=function(n){var i=this.m_text.substr(n,10),t=i.match(/^\s{0,3}(\*|\d+\.)(?:\ |\t)*/);return t?t[1]=="*"?{m_listType:"*",m_prefixLen:t[0].length}:{m_listType:"1",m_prefixLen:t[0].length}:{m_listType:"",m_prefixLen:0}};n=a.prototype;t=a.prototype;n.onKeyDown=function(n){var t=null,i;if(n.ctrlKey||n.metaKey){if(i=String.fromCharCode(n.charCode||n.keyCode),!this.disableShortCutKeys&&p[i]!=undefined)return this.InvokeCommand(p[i]),w(n);switch(i){case"V":t=c;break;case"X":t=y}}else switch(n.keyCode){case k:if(this.disableTabHandling)t=c;else return this.InvokeCommand(n.shiftKey?"untab":"tab"),w(n);break;case it:case rt:case ut:case ft:case nt:case tt:case d:case g:t=l;break;case et:case ot:t=y;break;case v:t=st;break;default:t=c}t!=null&&this.SetUndoMode(t);this.disableAutoIndent||n.keyCode==v&&(!s||n.ctrlKey)&&this.IndentNewLine()};n.SetUndoMode=function(n){this.m_undoMode!=n&&(this.m_undoMode=n,this.CaptureUndoState())};n.CaptureUndoState=function(){var n=new o;n.InitFromTextArea(this.m_textarea);this.m_undoStack.splice(this.m_undoPos,this.m_undoStack.length-this.m_undoPos,n);this.m_undoPos=this.m_undoStack.length};n.onMarkdownChanged=function(){var n=this.m_textarea.value,t;if(n!==this.m_lastContent||this.m_lastContent===null){if(this.onPreTransform)this.onPreTransform(this,n);if(t=this.Markdown.Transform(n),this.onPostTransform)this.onPostTransform(this,t);if(this.m_divHtml&&(this.m_divHtml.innerHTML=t),this.onPostUpdateDom)this.onPostUpdateDom(this);this.m_lastContent=n}};t.onOptionsChanged=function(){this.m_lastContent=null;this.onMarkdownChanged()};t.cmd_undo=function(){this.m_undoPos>0&&(this.m_undoPos==this.m_undoStack.length&&(this.CaptureUndoState(),this.m_undoPos--),this.m_undoPos--,this.m_undoStack[this.m_undoPos].Apply(),this.m_undoMode=h,this.onMarkdownChanged())};t.cmd_redo=function(){this.m_undoPos+1<this.m_undoStack.length&&(this.m_undoPos++,this.m_undoStack[this.m_undoPos].Apply(),this.m_undoMode=h,this.onMarkdownChanged(),this.m_undoPos==this.m_undoStack.length-1&&this.m_undoStack.pop())};n.setHeadingLevel=function(n,t){var i,u,r,e,o,s,h;if(n.SelectParagraph(),n.SelectSurroundingWhiteSpace(),i=n.getSelectedText(),i=f(i),u=0,r=i.match(/^(\#+)(.*?)(\#+)?$/),r?(i=f(r[2]),u=r[1].length):(r=i.match(/^(.*?)(?:\r\n|\n|\r)\s*(\-*|\=*)$/),r?(i=f(r[1]),u=r[2].charAt(0)=="="?1:0):(i=i.replace(/(\r\n|\n|\r)/gm,""),u=0)),t==-1&&(t=(u+1)%4),e=0,o=0,t==0){if(i=="Heading")return n.ReplaceSelection(""),!0;o=i.length;e=0}else{for(i==""&&(i="Heading"),e=t+1,o=i.length,s="",h=0;h<t;h++)s+="#";i=s+" "+i+" "+s}return i+="\n\n",n.m_selectionStart!=0&&(i="\n\n"+i,e+=2),n.ReplaceSelection(i),n.m_selectionStart+=e,n.m_selectionEnd=n.m_selectionStart+o,!0};t.cmd_heading=function(n){return this.setHeadingLevel(n,-1)};t.cmd_h0=function(n){return this.setHeadingLevel(n,0)};t.cmd_h1=function(n){return this.setHeadingLevel(n,1)};t.cmd_h2=function(n){return this.setHeadingLevel(n,2)};t.cmd_h3=function(n){return this.setHeadingLevel(n,3)};t.cmd_h4=function(n){return this.setHeadingLevel(n,4)};t.cmd_h5=function(n){return this.setHeadingLevel(n,5)};t.cmd_h6=function(n){return this.setHeadingLevel(n,6)};n.IndentCodeBlock=function(n,t){var r,o,e,h,i,s;for(n.SelectWholeLines(),r=n.getSelectedText().split("\n"),i=0;i<r.length;i++)if(r[i].charAt(0)=="\t"){for(o="",e=0;r[i].charAt(e)=="\t";)o+="    ",e++;h=o+r[i].substr(e);r.splice(i,1,h)}if(t===null){for(i=0;i<r.length;i++)if(f(r[i])!=""){if(r[i].charAt(0)=="\t"){for(o="",e=0;r[i].charAt(e)=="\t";)o+="    ",e++;h=o+r[i].substr(i);r.splice(i,1,h)}if(!u(r[i],"    "))break}t=i!=r.length}for(i=0;i<r.length;i++)f(r[i])!=""&&(s=r[i],t?s="    "+r[i]:u(r[i],"\t")?s=r[i].substr(1):u(r[i],"    ")&&(s=r[i].substr(4)),r.splice(i,1,s));n.ReplaceSelection(r.join("\n"))};t.cmd_code=function(n){if(n.m_selectionStart==n.m_selectionEnd){var t=n.FindStartOfLine(n.m_selectionStart);if(n.IsBlankLine(t))return n.SelectSurroundingWhiteSpace(),n.ReplaceSelection("\n\n    Code\n\n"),n.m_selectionStart+=6,n.m_selectionEnd=n.m_selectionStart+4,!0}return n.getSelectedText().indexOf("\n")<0?(n.TrimSelection(),n.PreceededBy("`")&&n.m_selectionStart--,n.FollowedBy("`")&&n.m_selectionEnd++,this.bold_or_italic(n,"`")):(this.IndentCodeBlock(n,null),!0)};t.cmd_tab=function(n){var i,t,r;if(n.getSelectedText().indexOf("\n")>0)this.IndentCodeBlock(n,!0);else{for(i=n.FindStartOfLine(n.m_selectionStart),t=i;t<n.m_selectionStart;t++)if(n.m_text.charAt(t)!=" ")break;t==n.m_selectionStart?(r=4-(t-i)%4,n.ReplaceSelection("    ".substr(0,r))):n.ReplaceSelection("\t");n.m_selectionStart=n.m_selectionEnd}return!0};t.cmd_untab=function(n){return n.getSelectedText().indexOf("\n")>0?(this.IndentCodeBlock(n,!1),!0):!1};n.bold_or_italic=function(n,t){var f=n.m_text,r=t.length,i=n.getSelectedText();return u(i,t)&&ht(i,t)?n.ReplaceSelection(i.substr(r,i.length-r*2)):(n.TrimSelection(),i=n.getSelectedText(),i=i?i.replace(/(\r\n|\n|\r)/gm,""):"text",n.ReplaceSelection(t+i+t),n.InflateSelection(-r,-r)),!0};t.cmd_bold=function(n){return n.CheckSimpleSelection()?(n.TrimSelection(),n.PreceededBy("**")&&(n.m_selectionStart-=2),n.FollowedBy("**")&&(n.m_selectionEnd+=2),this.bold_or_italic(n,"**")):!1};t.cmd_italic=function(n){return n.CheckSimpleSelection()?(n.TrimSelection(),(n.PreceededBy("*")&&!n.PreceededBy("**")||n.PreceededBy("***"))&&(n.m_selectionStart-=1),(n.FollowedBy("*")&&!n.PreceededBy("**")||n.FollowedBy("***"))&&(n.m_selectionEnd+=1),this.bold_or_italic(n,"*")):!1};n.indent_or_outdent=function(n,t){var i,r,f;if(!1&&n.m_selectionStart==n.m_selectionEnd)return n.SelectSurroundingWhiteSpace(),n.ReplaceSelection("\n\n> Quote\n\n"),n.m_selectionStart+=4,n.m_selectionEnd=n.m_selectionStart+5,!0;for(n.SelectWholeLines(),i=n.getSelectedText().split("\n"),r=0;r<i.length-1;r++)f=i[r],t?u(i[r],"> ")&&(f=i[r].substr(2)):f="> "+i[r],i.splice(r,1,f);return n.ReplaceSelection(i.join("\n")),!0};t.cmd_indent=function(n){return this.indent_or_outdent(n,!1)};t.cmd_outdent=function(n){return this.indent_or_outdent(n,!0)};n.handle_list=function(n,t){var f=[],c,r,s,u,o,i,e,l,h;if(n.getSelectedText().indexOf("\n")>0)for(n.SelectWholeLines(),r=n.m_selectionStart,f.push(r);;){if(r=n.FindNextLine(r),r>=n.m_selectionEnd)break;f.push(r)}else f.push(n.FindStartOfLine(n.m_selectionStart));for(c=t=="*"?"* ":"1. ",i=0;i<f.length;i++)if(e=n.DetectListType(f[i]),e.m_listType==t){c="";break}for(i=f.length-1;i>=0;i--)r=f[i],e=n.DetectListType(r),n.ReplaceAt(r,e.m_prefixLen,c);for(s=new MarkdownDeep.Markdown,s.ExtraMode=!0,u=s.GetListItems(n.m_text,n.m_selectionStart);u!=null;){for(o=0,i=0;i<u.length-1;i++){if(e=n.DetectListType(u[i]+o),e.m_listType!="1")break;l=(i+1).toString()+". ";n.ReplaceAt(u[i]+o,e.m_prefixLen,l);o+=l.length-e.m_prefixLen}h=s.GetListItems(n.m_text,u[u.length-1]+o);u=h!=null&&h[0]!=u[0]?h:null}return f.length>1&&n.SelectWholeLines(),!0};t.cmd_ullist=function(n){return this.handle_list(n,"*")};t.cmd_ollist=function(n){return this.handle_list(n,"1")};t.cmd_link=function(n){var i,t,r;return(n.TrimSelection(),!n.CheckSimpleSelection())?!1:(i=prompt("Enter the target URL:"),i===null)?!1:(t=n.getSelectedText(),t.length==0&&(t="link text"),r="["+t+"]("+i+")",n.ReplaceSelection(r),n.m_selectionStart++,n.m_selectionEnd=n.m_selectionStart+t.length,!0)};t.cmd_img=function(n){var i,t,r;return(n.TrimSelection(),!n.CheckSimpleSelection())?!1:(i=prompt("Enter the image URL"),i===null)?!1:(t=n.getSelectedText(),t.length==0&&(t="Image Text"),r="!["+t+"]("+i+")",n.ReplaceSelection(r),n.m_selectionStart+=2,n.m_selectionEnd=n.m_selectionStart+t.length,!0)};t.cmd_hr=function(n){return n.SelectSurroundingWhiteSpace(),n.m_selectionStart==0?n.ReplaceSelection("----------\n\n"):n.ReplaceSelection("\n\n----------\n\n"),n.m_selectionStart=n.m_selectionEnd,!0};t.IndentNewLine=function(){var t=this,n,i=function(){var i,r,u,f;for(window.clearInterval(n),i=new o,i.InitFromTextArea(t.m_textarea),r=i.FindStartOfLine(i.SkipPreceedingEol(i.m_selectionStart)),u=r;;){if(f=i.m_text.charAt(u),f!=" "&&f!="\t")break;u++}u>r&&(i.ReplaceSelection(i.m_text.substr(r,u-r)),i.m_selectionStart=i.m_selectionEnd);i.Apply()};return n=window.setInterval(i,1),!1};t.cmd_indented_newline=function(n){var t,i,r;for(n.ReplaceSelection("\n"),n.m_selectionStart=n.m_selectionEnd,t=n.FindStartOfLine(n.SkipPreceedingEol(n.m_selectionStart)),i=t;;){if(r=n.m_text.charAt(i),r!=" "&&r!="\t")break;i++}return i>t&&(n.ReplaceSelection(n.m_text.substr(t,i-t)),n.m_selectionStart=n.m_selectionEnd),!0};t.InvokeCommand=function(n){var t,i;if(n=="undo"||n=="redo"){this["cmd_"+n]();this.m_textarea.focus();return}return t=new o,t.InitFromTextArea(this.m_textarea),i=t.Duplicate(),this["cmd_"+n](t)?(this.m_undoMode=h,this.m_undoStack.splice(this.m_undoPos,this.m_undoStack.length-this.m_undoPos,i),this.m_undoPos++,t.Apply(),this.onMarkdownChanged(),!0):(this.m_textarea.focus(),!1)};delete n;delete t;this.Editor=a},MarkdownDeepEditorUI=new function(){this.HelpHtmlWritten=!1;this.HelpHtml=function(n){var t="";return t+='<div class="mdd_modal" id="mdd_syntax_container" style="display:none">\n',t+='<div class="mdd_modal_frame">\n',t+='<div class="mdd_modal_button">\n',t+='<a href="'+n+'" id="mdd_help_location" style="display:none"><\/a>\n',t+='<a href="#" id="mdd_close_help">Close<\/a>\n',t+="<\/div>\n",t+='<div class="mdd_modal_content">\n',t+='<div class="mdd_syntax" id="mdd_syntax">\n',t+='<div class="mdd_ajax_loader"><\/div>\n',t+="<\/div>\n",t+="<\/div>\n",t+="<\/div>\n",t+"<\/div>\n"};this.ToolbarHtml=function(){var n="";return n+='<div class="mdd_links">\n',n+='<a href="#" class="mdd_help" tabindex=-1>How to Format<\/a>\n',n+="<\/div>\n",n+="<ul>\n",n+='<li><a href="#" class="mdd_button" id="mdd_undo" title="Undo (Ctrl+Z)" tabindex=-1><\/a><\/li>\n',n+='<li><a href="#" class="mdd_button" id="mdd_redo" title="Redo (Ctrl+Y)" tabindex=-1><\/a><\/li>\n',n+='<li><span class="mdd_sep"><\/span><\/li>\n',n+='<li><a href="#" class="mdd_button" id="mdd_heading" title="Change Heading Style (Ctrl+H, or Ctrl+0 to Ctrl+6)" tabindex=-1><\/a><\/li>\n',n+='<li><a href="#" class="mdd_button" id="mdd_code" title="Preformatted Code (Ctrl+K or Tab/Shift+Tab on multiline selection)" tabindex=-1><\/a><\/li>\n',n+='<li><span class="mdd_sep"><\/span><\/li>\n',n+='<li><a href="#" class="mdd_button" id="mdd_bold" title="Bold (Ctrl+B)" tabindex=-1><\/a><\/li>\n',n+='<li><a href="#" class="mdd_button" id="mdd_italic" title="Italic (Ctrl+I)" tabindex=-1><\/a><\/li>\n',n+='<li><span class="mdd_sep"><\/span><\/li>\n',n+='<li><a href="#" class="mdd_button" id="mdd_ullist" title="Bullets (Ctrl+U)" tabindex=-1><\/a><\/li>\n',n+='<li><a href="#" class="mdd_button" id="mdd_ollist" title="Numbering (Ctrl+O)" tabindex=-1><\/a><\/li>\n',n+='<li><a href="#" class="mdd_button" id="mdd_outdent" title="Unquote (Ctrl+W)" tabindex=-1><\/a><\/li>\n',n+='<li><a href="#" class="mdd_button" id="mdd_indent" title="Quote (Ctrl+Q)" tabindex=-1><\/a><\/li>\n',n+='<li><span class="mdd_sep"><\/span><\/li>\n',n+='<li><a href="#" class="mdd_button" id="mdd_link" title="Insert Hyperlink (Ctrl+L)" tabindex=-1><\/a><\/li>\n',n+='<li><a href="#" class="mdd_button" id="mdd_img" title="Insert Image (Ctrl+G)" tabindex=-1><\/a><\/li>\n',n+='<li><a href="#" class="mdd_button" id="mdd_hr" title="Insert Horizontal Rule (Ctrl+R)" tabindex=-1><\/a><\/li>\n',n+="<\/ul>\n",n+'<div style="clear:both"><\/div>\n'};this.onResizerMouseDown=function(n){function f(){return $(document).unbind("mousemove.mdd"),$(document).unbind("mouseup.mdd"),!1}function e(n){var i=u+n.clientY-r;return i<50&&(i=50),$(t).height(i),!1}var i=window.event?n.srcElement:n.target,t=$(i).closest(".mdd_resizer_wrap").prev(".mdd_editor_wrap").children("textarea")[0],r=n.clientY,u=$(t).height();return $(document).bind("mousemove.mdd",e),$(document).bind("mouseup.mdd",f),!1};var n=0,t=!1;this.onShowHelpPopup=function(){if($("#mdd_syntax_container").fadeIn("fast"),$(".modal_content").scrollTop(n),$(document).bind("keydown.mdd",function(n){if(n.keyCode==27)return MarkdownDeepEditorUI.onCloseHelpPopup(),!1}),!t){t=!0;var i=$("#mdd_help_location").attr("href");i||(i="mdd_help.htm");$("#mdd_syntax").load(i)}return!1};this.onCloseHelpPopup=function(){return n=$(".modal_content").scrollTop(),$("#mdd_syntax_container").fadeOut("fast"),$(document).unbind("keydown.mdd"),$(document).unbind("scroll.mdd"),!1};this.onToolbarButton=function(n){var t=$(n.target).closest("div.mdd_toolbar_wrap").next(".mdd_editor_wrap").children("textarea").data("mdd");return t.InvokeCommand($(n.target).attr("id").substr(4)),!1}};(function(n){n.fn.MarkdownDeep=function(t){var i={resizebar:!0,toolbar:!0,preview:!0,help_location:"mdd_help.html"};return t&&n.extend(i,t),this.each(function(){var f=n(this).parent(".mdd_editor_wrap"),h,r,l,u,e,o,c,s;f.length==0&&(f=n(this).wrap('<div class="mdd_editor_wrap" />').parent());i.toolbar&&(h=f.prev(".mdd_toolbar_wrap"),r=f.prev(".mdd_toolbar"),h.length==0?(r.length==0&&(r=n('<div class="mdd_toolbar" />'),r.insertBefore(f)),h=r.wrap('<div class="mdd_toolbar_wrap" />').parent()):r.length==0&&(r=n('<div class="mdd_toolbar" />'),h.html(r)),r.append(n(MarkdownDeepEditorUI.ToolbarHtml())),n("a.mdd_button",r).click(MarkdownDeepEditorUI.onToolbarButton),n("a.mdd_help",r).click(MarkdownDeepEditorUI.onShowHelpPopup),MarkdownDeepEditorUI.HelpHtmlWritten||(l=n(MarkdownDeepEditorUI.HelpHtml(i.help_location)),l.appendTo(n("body")),n("#mdd_close_help").click(MarkdownDeepEditorUI.onCloseHelpPopup),MarkdownDeepEditorUI.HelpHtmlWritten=!0));i.resizebar&&(e=f.next(".mdd_resizer_wrap"),u=e.length==0?f.next(".mdd_resizer"):e.children(".mdd_resizer"),e.length==0?(u.length==0&&(u=n('<div class="mdd_resizer" />'),u.insertAfter(f)),e=u.wrap('<div class="mdd_resizer_wrap" />').parent()):u.length==0&&(u=n('<div class="mdd_resizer" />'),e.html(u)),e.bind("mousedown",MarkdownDeepEditorUI.onResizerMouseDown));o=null;i.preview===!0&&(c=n(this).attr("data-mdd-preview"),c||(c=".mdd_preview"),o=n(c)[0],o||(n('<div class="mdd_preview"><\/div>').insertAfter(u?u:this),o=n(".mdd_preview")[0]));s=new MarkdownDeepEditor.Editor(this,o);t&&(jQuery.extend(s.Markdown,t),jQuery.extend(s,t));s.onOptionsChanged();n(this).data("mdd",s)})}})(jQuery);
/*
//# sourceMappingURL=MarkdownDeepLib.min.js.map
*/